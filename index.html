<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°–å«çˆ†å‘å™¨Plusç‰ˆ</title>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½®å’Œå…¨é¡µé¢è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            touch-action: none; /* é˜²æ­¢æµè§ˆå™¨å¤„ç†è§¦æ‘¸äº‹ä»¶ */
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        #gameContainer {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        /* å¤´éƒ¨ */
        #gameHeader {
            width: 100%;
            text-align: center;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
        }
        
        /* ä¸»æ¸¸æˆåŒºåŸŸ */
        #gameplayArea {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* å˜´å·´æŒ‰é’® */
        #mouthButton {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ff6b6b;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            z-index: 20;
        }
        
        #mouthButton:active {
            transform: scale(0.95);
        }
        
        /* ç‰¹æ•ˆå®¹å™¨ */
        #effectsContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 5;
        }
        
        /* å‹åŠ›è®¡ */
        #pressureMeter {
            width: 80%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }
        
        #pressureBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            transition: width 0.1s;
        }
        
        #pressureValue {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            color: #333;
        }
        
        /* æ‰“å¡é¢æ¿ */
        #checkinPanel {
            width: 90%;
            max-height: 40%;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 30;
        }
        
        .checkinHeader {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .checkinGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .checkinDay {
            padding: 5px;
            text-align: center;
            border-radius: 5px;
            background-color: #f0f0f0;
            font-size: 14px;
            position: relative;
        }
        
        .checkinDay.active {
            background-color: #4facfe;
            color: white;
        }
        
        .checkinValue {
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 2px;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 40;
        }
        
        .controlButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 20px;
        }
        
        /* å£°æ³¢åŠ¨ç”» */
        @keyframes soundWave {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        .soundWave {
            position: absolute;
            border-radius: 50%;
            border: 2px solid #ff6b6b;
            animation: soundWave 1s infinite;
            pointer-events: none;
        }
        
        /* å¼¹å‡ºæ¶ˆæ¯ */
        #popupMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 18px;
            z-index: 50;
            display: none;
        }
        
        /* å“åº”å¼é€‚é…ä¸åŒè®¾å¤‡å°ºå¯¸ */
        @media (max-height: 600px) {
            #mouthButton {
                width: 100px;
                height: 100px;
                font-size: 50px;
            }
            
            #checkinPanel {
                max-height: 30%;
            }
        }
        
        @media (max-width: 360px) {
            #mouthButton {
                width: 90px;
                height: 90px;
                font-size: 45px;
            }
            
            .checkinGrid {
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
            }
            
            .checkinDay {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameHeader">å°–å«çˆ†å‘å™¨Plusç‰ˆ</div>
        
        <div id="gameplayArea">
            <div id="mouthButton">ğŸ˜®</div>
            <div id="effectsContainer"></div>
        </div>
        
        <div id="pressureMeter">
            <div id="pressureBar"></div>
            <div id="pressureValue">0%</div>
        </div>
        
        <div id="checkinPanel">
            <div class="checkinHeader">
                æœ¬æœˆæœ€é«˜é‡Šæ”¾å€¼: <span id="monthMax">0</span>
            </div>
            <div class="checkinGrid" id="checkinGrid"></div>
        </div>
        
        <div id="controls">
            <div class="controlButton" id="toggleCheckin">ğŸ“…</div>
            <div class="controlButton" id="toggleEffects">âœ¨</div>
            <div class="controlButton" id="toggleSound">ğŸ”Š</div>
        </div>
    </div>
    
    <div id="popupMessage"></div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            isPressed: false,
            pressStartTime: 0,
            currentPressure: 0,
            maxPressure: 0,
            lastPressureUpdate: 0,
            pressureIncreaseRate: 2, // æ¯100mså¢åŠ çš„ç™¾åˆ†æ¯”
            effectsEnabled: true,
            soundEnabled: true,
            checkinVisible: false,
            particles: [],
            soundWaves: [],
            maxParticles: 150, // æ€§èƒ½é™åˆ¶
            touchType: '', // 'short', 'long', æˆ– 'rapid'
            rapidPressCount: 0,
            rapidPressTimeout: null,
            animationFrameId: null,
            lastFrame: 0
        };
        
        // DOMå…ƒç´ 
        const mouthButton = document.getElementById('mouthButton');
        const effectsContainer = document.getElementById('effectsContainer');
        const pressureBar = document.getElementById('pressureBar');
        const pressureValue = document.getElementById('pressureValue');
        const checkinPanel = document.getElementById('checkinPanel');
        const checkinGrid = document.getElementById('checkinGrid');
        const monthMax = document.getElementById('monthMax');
        const popupMessage = document.getElementById('popupMessage');
        const toggleCheckin = document.getElementById('toggleCheckin');
        const toggleEffects = document.getElementById('toggleEffects');
        const toggleSound = document.getElementById('toggleSound');
        
        // æ£€æŸ¥å­˜å‚¨æ˜¯å¦å¯ç”¨
        function storageAvailable(type) {
            try {
                const storage = window[type];
                const x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return true;
            } catch (e) {
                return false;
            }
        }
        
        // æœ¬åœ°å­˜å‚¨åŠŸèƒ½
        function saveCheckin(pressure) {
            if (!storageAvailable('localStorage')) return;
            
            const today = new Date();
            const dateKey = today.toISOString().split('T')[0]; // YYYY-MM-DD
            const monthKey = dateKey.substring(0, 7); // YYYY-MM
            
            // è·å–ç°æœ‰æ•°æ®
            let checkinData = JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
            
            // æ›´æ–°ä»Šå¤©çš„æ•°æ®
            if (!checkinData[dateKey] || pressure > checkinData[dateKey]) {
                checkinData[dateKey] = pressure;
            }
            
            // æ›´æ–°æœˆæœ€å¤§å€¼
            let monthMaxValue = 0;
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('screamCheckinData', JSON.stringify(checkinData));
            
            // æ›´æ–°UI
            updateCheckinDisplay();
        }
        
        function loadCheckinData() {
            if (!storageAvailable('localStorage')) return {};
            
            return JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
        }
        
        function updateCheckinDisplay() {
            // æ¸…é™¤ç°æœ‰ç½‘æ ¼
            checkinGrid.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // æœˆä»½ç¬¬ä¸€å¤©
            const firstDay = new Date(currentYear, currentMonth, 1);
            // æœˆä»½æœ€åä¸€å¤©
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            
            // ç¬¬ä¸€å¤©çš„æ˜ŸæœŸï¼ˆ0=å‘¨æ—¥ï¼Œ6=å‘¨å…­ï¼‰
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // åˆ›å»ºæ˜ŸæœŸæ ‡é¢˜ï¼ˆå‘¨æ—¥-å‘¨å…­ï¼‰
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'checkinDay';
                dayHeader.style.backgroundColor = '#ddd';
                dayHeader.textContent = day;
                checkinGrid.appendChild(dayHeader);
            });
            
            // ä¸ºæœˆä»½ç¬¬ä¸€å¤©ä¹‹å‰æ·»åŠ ç©ºå•å…ƒæ ¼
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'checkinDay';
                emptyDay.style.visibility = 'hidden';
                checkinGrid.appendChild(emptyDay);
            }
            
            // è·å–æ‰“å¡æ•°æ®
            const checkinData = loadCheckinData();
            
            // è®¡ç®—æœˆæœ€å¤§å€¼
            let monthMaxValue = 0;
            const monthKey = today.toISOString().substring(0, 7); // YYYY-MM
            
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // æ›´æ–°æœˆæœ€å¤§å€¼æ˜¾ç¤º
            monthMax.textContent = monthMaxValue.toFixed(0);
            
            // æ·»åŠ æœˆä»½çš„å¤©æ•°
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'checkinDay';
                dayCell.textContent = i;
                
                // æ£€æŸ¥è¿™ä¸€å¤©æ˜¯å¦æœ‰æ‰“å¡
                const dateString = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                
                if (checkinData[dateString]) {
                    dayCell.classList.add('active');
                    
                    // æ·»åŠ å‹åŠ›å€¼
                    const valueSpan = document.createElement('div');
                    valueSpan.className = 'checkinValue';
                    valueSpan.textContent = checkinData[dateString].toFixed(0);
                    dayCell.appendChild(valueSpan);
                }
                
                checkinGrid.appendChild(dayCell);
            }
        }
        
        // ç‰¹æ•ˆç”ŸæˆåŠŸèƒ½
        function createParticle(pressure) {
            if (!gameState.effectsEnabled || gameState.particles.length >= gameState.maxParticles) return;
            
            // åˆ›å»ºç²’å­å…ƒç´ 
            const particle = document.createElement('div');
            particle.style.position = 'absolute';
            particle.style.pointerEvents = 'none';
            
            // åœ¨æŒ‰é’®å‘¨å›´éšæœºå®šä½
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            const distance = 50 + (Math.random() * pressure * 1.5); // å‹åŠ›è¶Šé«˜ï¼Œè·ç¦»è¶Šè¿œ
            
            const posX = centerX + Math.cos(angle) * distance;
            const posY = centerY + Math.sin(angle) * distance;
            
            particle.style.left = posX + 'px';
            particle.style.top = posY + 'px';
            
            // æ ¹æ®å‹åŠ›ç¡®å®šå†…å®¹
            let content;
            let fontSize;
            
            if (pressure < 30) {
                // ä½å‹åŠ›ï¼šç®€å•æ–‡æœ¬
                const options = ['a', 'ã‚', 'å•Š', 'ì•„', '!', '?', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²'];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 12 + Math.random() * 8;
            } else if (pressure < 70) {
                // ä¸­ç­‰å‹åŠ›ï¼šæ›´å…·è¡¨ç°åŠ›
                const options = ['aa', 'ã‚ã‚', 'å•Šå•Š', 'ì•„ì•„', '!!', '?!', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ˜±', 'ğŸ˜«'];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 16 + Math.random() * 12;
            } else {
                // é«˜å‹åŠ›ï¼šå¼ºçƒˆè¡¨è¾¾
                const options = [
                    'AAA', 'ã‚ã‚ã‚', 'å•Šå•Šå•Š', 'ì•„ì•„ì•„', '!!!', '?!!', 
                    'ğŸ˜±', 'ğŸ˜«', 'ğŸ˜–', 'ğŸ˜µ', 'ğŸ˜¨', 'ğŸ’¥', 'ğŸ’«', 'ğŸ’¢', 'âš¡'
                ];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 20 + Math.random() * 16;
            }
            
            // åº”ç”¨æ ·å¼
            particle.textContent = content;
            particle.style.fontSize = fontSize + 'px';
            particle.style.opacity = '0.9';
            particle.style.transform = 'rotate(' + (Math.random() * 40 - 20) + 'deg)';
            
            // åŠ¨ç”»è®¾ç½®
            const duration = 1000 + Math.random() * 1000; // 1-2ç§’
            const directionX = (Math.random() - 0.5) * (pressure / 20); // å‹åŠ›è¶Šé«˜ï¼Œæ‰©æ•£è¶Šå¤§
            const directionY = (Math.random() - 0.5 - 0.2) * (pressure / 15); // è½»å¾®å‘ä¸Šåç§»
            
            // æ·»åŠ åˆ°DOM
            effectsContainer.appendChild(particle);
            
            // æ·»åŠ åˆ°ç²’å­æ•°ç»„
            gameState.particles.push({
                element: particle,
                posX,
                posY,
                directionX,
                directionY,
                rotation: (Math.random() - 0.5) * 10,
                opacity: 0.9,
                duration,
                elapsed: 0
            });
        }
        
        function createSoundWave(pressure) {
            if (!gameState.effectsEnabled) return;
            
            const wave = document.createElement('div');
            wave.className = 'soundWave';
            
            const size = 80 + pressure * 1.5;
            wave.style.width = size + 'px';
            wave.style.height = size + 'px';
            
            // å±…ä¸­å®šä½
            wave.style.left = 'calc(50% - ' + (size / 2) + 'px)';
            wave.style.top = 'calc(50% - ' + (size / 2) + 'px)';
            
            // åŸºäºå‹åŠ›çš„åŠ¨ç”»æŒç»­æ—¶é—´
            const duration = 1000 - (pressure * 5); // å‹åŠ›è¶Šé«˜è¶Šå¿«
            wave.style.animationDuration = Math.max(duration, 300) + 'ms';
            
            // æ·»åŠ åˆ°DOM
            effectsContainer.appendChild(wave);
            
            // æ·»åŠ åˆ°æ³¢æ•°ç»„
            gameState.soundWaves.push({
                element: wave,
                duration: Math.max(duration, 300),
                elapsed: 0
            });
        }
        
        function applyScreenShake(pressure) {
            if (!gameState.effectsEnabled || pressure < 40) return;
            
            const intensity = pressure / 10;
            const gameContainer = document.getElementById('gameContainer');
            
            // æ¸…é™¤ç°æœ‰çš„æŠ–åŠ¨
            gameContainer.style.transform = 'none';
            
            // æŠ–åŠ¨æ•ˆæœçš„éšæœºä½ç½®
            const shakeX = (Math.random() - 0.5) * intensity;
            const shakeY = (Math.random() - 0.5) * intensity;
            
            gameContainer.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
            
            // çŸ­æš‚å»¶è¿Ÿåé‡ç½®
            setTimeout(() => {
                gameContainer.style.transform = 'none';
            }, 50);
        }
        
        function updateVisualEffects(deltaTime) {
            // æ›´æ–°ç²’å­
            for (let i = gameState.particles.length - 1; i >= 0; i--) {
                const particle = gameState.particles[i];
                particle.elapsed += deltaTime;
                
                if (particle.elapsed >= particle.duration) {
                    // ç§»é™¤è¿‡æœŸç²’å­
                    particle.element.remove();
                    gameState.particles.splice(i, 1);
                } else {
                    // æ›´æ–°ä½ç½®
                    particle.posX += particle.directionX * deltaTime * 0.1;
                    particle.posY += particle.directionY * deltaTime * 0.1;
                    
                    // æ›´æ–°ä¸é€æ˜åº¦
                    const progress = particle.elapsed / particle.duration;
                    particle.opacity = 0.9 * (1 - progress);
                    
                    // åº”ç”¨æ›´æ–°
                    particle.element.style.left = particle.posX + 'px';
                    particle.element.style.top = particle.posY + 'px';
                    particle.element.style.opacity = particle.opacity;
                    particle.element.style.transform = `rotate(${particle.rotation * progress * 10}deg)`;
                }
            }
            
            // æ›´æ–°å£°æ³¢
            for (let i = gameState.soundWaves.length - 1; i >= 0; i--) {
                const wave = gameState.soundWaves[i];
                wave.elapsed += deltaTime;
                
                if (wave.elapsed >= wave.duration) {
                    // ç§»é™¤è¿‡æœŸæ³¢
                    wave.element.remove();
                    gameState.soundWaves.splice(i, 1);
                }
            }
        }
        
        // è§¦æ‘¸äº‹ä»¶å¤„ç†ç¨‹åº
        function handleTouchStart(e) {
            e.preventDefault();
            if (gameState.isPressed) return;
            
            gameState.isPressed = true;
            gameState.pressStartTime = Date.now();
            gameState.currentPressure = 0;
            gameState.lastPressureUpdate = Date.now();
            
            // å¤„ç†å¿«é€ŸæŒ‰å‹æ£€æµ‹
            if (gameState.rapidPressTimeout) {
                clearTimeout(gameState.rapidPressTimeout);
                gameState.rapidPressCount++;
                
                if (gameState.rapidPressCount >= 3) {
                    gameState.touchType = 'rapid';
                    // æ”¹å˜å˜´å·´åˆ°å¿«é€Ÿæ¨¡å¼
                    mouthButton.textContent = 'ğŸ˜¬';
                }
            } else {
                gameState.rapidPressCount = 1;
            }
            
            gameState.rapidPressTimeout = setTimeout(() => {
                gameState.rapidPressCount = 0;
                gameState.rapidPressTimeout = null;
            }, 500);
            
            // ä»¥æ­£å¸¸è¡¨æƒ…å¼€å§‹
            if (gameState.touchType !== 'rapid') {
                mouthButton.textContent = 'ğŸ˜®';
            }
            
            // å¦‚æœå°šæœªè¿è¡Œï¼Œåˆ™å¯åŠ¨åŠ¨ç”»å¾ªç¯
            if (!gameState.animationFrameId) {
                gameState.lastFrame = Date.now();
                gameState.animationFrameId = requestAnimationFrame(gameLoop);
            }
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            if (!gameState.isPressed) return;
            
            gameState.isPressed = false;
            const pressDuration = Date.now() - gameState.pressStartTime;
            
            // å¦‚æœå°šæœªç¡®å®šä¸ºå¿«é€ŸæŒ‰å‹ï¼Œåˆ™ç¡®å®šæŒ‰å‹ç±»å‹
            if (gameState.touchType !== 'rapid') {
                if (pressDuration < 300) {
                    gameState.touchType = 'short';
                    mouthButton.textContent = 'ğŸ˜¯';
                } else {
                    gameState.touchType = 'long';
                    
                    // æ ¹æ®æœ€ç»ˆå‹åŠ›é‡ç½®å˜´å·´
                    if (gameState.currentPressure > 80) {
                        mouthButton.textContent = 'ğŸ˜±';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = 'ğŸ˜²';
                    } else {
                        mouthButton.textContent = 'ğŸ˜®';
                    }
                }
            }
            
            // å¤„ç†é‡Šæ”¾æ•ˆæœ
            handlePressureRelease();
            
            // å»¶è¿Ÿåé‡ç½®
            setTimeout(() => {
                mouthButton.textContent = 'ğŸ˜®';
                gameState.touchType = '';
                gameState.currentPressure = 0;
                updatePressureDisplay();
            }, 1000);
        }
        
        function handlePressureRelease() {
            // ä¿å­˜è¾¾åˆ°çš„æœ€å¤§å‹åŠ›
            const finalPressure = gameState.currentPressure;
            gameState.maxPressure = Math.max(gameState.maxPressure, finalPressure);
            
            // ä¿å­˜æ‰“å¡
            saveCheckin(finalPressure);
            
            // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
            showPopupMessage('ä»Šæ—¥æ‰“å¡å®Œæˆï¼', 2000);
            
            // æ ¹æ®å‹åŠ›å’Œè§¦æ‘¸ç±»å‹åˆ›å»ºçˆ†å‘æ•ˆæœ
            if (gameState.effectsEnabled) {
                if (gameState.touchType === 'rapid') {
                    // å¿«é€ŸæŒ‰å‹æ•ˆæœï¼šå¤§é‡å°ç²’å­
                    for (let i = 0; i < 30; i++) {
                        createParticle(Math.min(finalPressure + 30, 100));
                    }
                } else if (gameState.touchType === 'short') {
                    // çŸ­æŒ‰æ•ˆæœï¼šå°‘é‡ä¸­ç­‰ç²’å­
                    for (let i = 0; i < 10; i++) {
                        createParticle(Math.min(finalPressure + 20, 100));
                    }
                } else {
                    // é•¿æŒ‰æ•ˆæœï¼šåŸºäºå‹åŠ›
                    const particleCount = Math.floor(finalPressure / 5) + 5;
                    for (let i = 0; i < particleCount; i++) {
                        createParticle(finalPressure);
                    }
                    
                    // é«˜å‹åŠ›çš„é¢å¤–æ•ˆæœ
                    if (finalPressure > 70) {
                        for (let i = 0; i < 20; i++) {
                            setTimeout(() => {
                                createParticle(finalPressure);
                                applyScreenShake(finalPressure);
                            }, i * 50);
                        }
                    }
                }
            }
        }
        
        // UIæ›´æ–°åŠŸèƒ½
        function updatePressureDisplay() {
            pressureBar.style.width = gameState.currentPressure + '%';
            pressureValue.textContent = Math.floor(gameState.currentPressure) + '%';
            
            // æ ¹æ®å‹åŠ›æ›´æ–°æŒ‰é’®å¤–è§‚
            if (gameState.isPressed) {
                if (gameState.touchType !== 'rapid') {
                    if (gameState.currentPressure > 80) {
                        mouthButton.textContent = 'ğŸ˜±';
                    } else if (gameState.currentPressure > 60) {
                        mouthButton.textContent = 'ğŸ˜«';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = 'ğŸ˜²';
                    } else if (gameState.currentPressure > 20) {
                        mouthButton.textContent = 'ğŸ˜¯';
                    }
                }
                
                // éšå‹åŠ›ç¨å¾®ç¼©æ”¾æŒ‰é’®
                const scale = 1 + (gameState.currentPressure / 500);
                mouthButton.style.transform = `scale(${scale})`;
            } else {
                mouthButton.style.transform = 'scale(1)';
            }
        }
        
        function showPopupMessage(message, duration) {
            popupMessage.textContent = message;
            popupMessage.style.display = 'block';
            
            setTimeout(() => {
                popupMessage.style.display = 'none';
            }, duration);
        }
        
        // ä¸»æ¸¸æˆå¾ªç¯
        function gameLoop() {
            const now = Date.now();
            const deltaTime = now - gameState.lastFrame;
            gameState.lastFrame = now;
            
            // å¦‚æœæŒ‰é’®è¢«æŒ‰ä¸‹ï¼Œåˆ™æ›´æ–°å‹åŠ›
            if (gameState.isPressed) {
                const elapsedSinceUpdate = now - gameState.lastPressureUpdate;
                
                if (elapsedSinceUpdate >= 100) { // æ¯100msæ›´æ–°ä¸€æ¬¡
                    // åŸºäºè§¦æ‘¸ç±»å‹çš„ä¸åŒå‹åŠ›å¢é•¿ç‡
                    let increaseAmount;
                    
                    if (gameState.touchType === 'rapid') {
                        increaseAmount = gameState.pressureIncreaseRate * 2.5;
                    } else {
                        increaseAmount = gameState.pressureIncreaseRate;
                    }
                    
                    gameState.currentPressure = Math.min(100, gameState.currentPressure + increaseAmount);
                    gameState.lastPressureUpdate = now;
                    
                    // åŸºäºå‹åŠ›åˆ›å»ºè§†è§‰æ•ˆæœ
                    if (gameState.currentPressure > 20) {
                        createSoundWave(gameState.currentPressure);
                        
                        if (Math.random() < gameState.currentPressure / 100) {
                            createParticle(gameState.currentPressure);
                        }
                        
                        if (gameState.currentPressure > 40 && Math.random() < 0.3) {
                            applyScreenShake(gameState.currentPressure);
                        }
                    }
                }
                
                updatePressureDisplay();
            }
            
            // æ›´æ–°æ‰€æœ‰è§†è§‰æ•ˆæœ
            updateVisualEffects(deltaTime);
            
            // ç»§ç»­å¾ªç¯
            gameState.animationFrameId = requestAnimationFrame(gameLoop);
            
            // å¦‚æœæ²¡æœ‰æ´»åŠ¨ï¼Œåœæ­¢å¾ªç¯
            if (!gameState.isPressed && gameState.particles.length === 0 && gameState.soundWaves.length === 0) {
                cancelAnimationFrame(gameState.animationFrameId);
                gameState.animationFrameId = null;
            }
        }
        
        // æ§åˆ¶åŠŸèƒ½
        function toggleCheckinPanel() {
            gameState.checkinVisible = !gameState.checkinVisible;
            checkinPanel.style.display = gameState.checkinVisible ? 'block' : 'none';
            
            if (gameState.checkinVisible) {
                updateCheckinDisplay();
            }
        }
        
        function toggleEffectsEnabled() {
            gameState.effectsEnabled = !gameState.effectsEnabled;
            toggleEffects.textContent = gameState.effectsEnabled ? 'âœ¨' : 'ğŸš«';
            
            if (!gameState.effectsEnabled) {
                // æ¸…é™¤æ‰€æœ‰ç°æœ‰æ•ˆæœ
                effectsContainer.innerHTML = '';
                gameState.particles = [];
                gameState.soundWaves = [];
            }
        }
        
        function toggleSoundEnabled() {
            gameState.soundEnabled = !gameState.soundEnabled;
            toggleSound.textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        mouthButton.addEventListener('touchstart', handleTouchStart);
        mouthButton.addEventListener('touchmove', handleTouchMove);
        mouthButton.addEventListener('touchend', handleTouchEnd);
        
        // é¼ æ ‡å›é€€ï¼Œç”¨äºåœ¨æ¡Œé¢ä¸Šæµ‹è¯•
        mouthButton.addEventListener('mousedown', handleTouchStart);
        mouthButton.addEventListener('mousemove', handleTouchMove);
        mouthButton.addEventListener('mouseup', handleTouchEnd);
        
        // æ§åˆ¶æŒ‰é’®
        toggleCheckin.addEventListener('click', toggleCheckinPanel);
        toggleEffects.addEventListener('click', toggleEffectsEnabled);
        toggleSound.addEventListener('click', toggleSoundEnabled);
        
        // é˜²æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸ºä»¥é¿å…æ»šåŠ¨
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
        
        // åˆå§‹è®¾ç½®
        updateCheckinDisplay();
        
        // æ¬¢è¿æ¶ˆæ¯
        showPopupMessage('æ¬¢è¿ä½¿ç”¨å°–å«çˆ†å‘å™¨Plusç‰ˆï¼', 2000);
    </script>
</body>
</html>
