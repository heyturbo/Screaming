<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°–å«çˆ†å‘å™¨Plusç‰ˆ</title>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½®å’Œå…¨é¡µé¢è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            touch-action: none; /* é˜²æ­¢æµè§ˆå™¨å¤„ç†è§¦æ‘¸äº‹ä»¶ */
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        #gameContainer {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        /* å¤´éƒ¨ */
        #gameHeader {
            width: 100%;
            text-align: center;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
        }
        
        /* ä¸»æ¸¸æˆåŒºåŸŸ */
        #gameplayArea {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* å˜´å·´æŒ‰é’® */
        #mouthButton {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, #ff8585 0%, #ff6b6b 70%, #ff5252 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
            user-select: none;
            z-index: 20;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4), 
                        0 2px 8px rgba(0, 0, 0, 0.2),
                        inset 0 -2px 5px rgba(0, 0, 0, 0.1),
                        inset 0 2px 5px rgba(255, 255, 255, 0.5);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        #mouthButton:active {
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3), 
                        0 1px 4px rgba(0, 0, 0, 0.15),
                        inset 0 -1px 3px rgba(0, 0, 0, 0.2),
                        inset 0 1px 3px rgba(255, 255, 255, 0.3);
        }
        
        #mouthButton::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0) 60%);
            pointer-events: none;
        }
        
        /* ç‰¹æ•ˆå®¹å™¨ */
        #effectsContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 5;
        }
        
        /* å‹åŠ›è®¡ */
        #pressureMeter {
            width: 80%;
            height: 24px;
            background-color: rgba(221, 221, 221, 0.5);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2), 
                        0 1px 2px rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(200, 200, 200, 0.8);
        }
        
        #pressureBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, 
                            #4facfe 0%, 
                            #00f2fe 50%, 
                            #ff9a8b 75%, 
                            #ff6a88 87%, 
                            #ff0844 100%);
            background-size: 200% 100%;
            transition: width 0.1s;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        #pressureBar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to bottom, 
                            rgba(255, 255, 255, 0.3) 0%, 
                            rgba(255, 255, 255, 0) 100%);
        }
        
        #pressureValue {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            z-index: 1;
        }
        
        /* æ‰“å¡é¢æ¿ */
        #checkinPanel {
            width: 90%;
            max-height: 40%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            overflow-y: auto;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1), 
                        0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 30;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .checkinHeader {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            padding: 8px;
            border-radius: 10px;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            color: #333;
        }
        
        .checkinGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .checkinDay {
            padding: 5px;
            text-align: center;
            border-radius: 8px;
            background-color: #f0f0f0;
            font-size: 14px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .checkinDay:not(.active):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .checkinDay.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
        }
        
        .checkinValue {
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 2px;
            padding: 1px 3px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 4px;
            color: #ff6b6b;
            font-weight: bold;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        /* ç»Ÿè®¡æ•°æ®å®¹å™¨ */
        #statsContainer {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 5px;
            border-radius: 10px;
            background-color: rgba(240, 240, 240, 0.5);
        }
        
        .statItem {
            flex: 1;
            text-align: center;
            padding: 8px 5px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.7);
            margin: 0 3px;
        }
        
        .statLabel {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }
        
        .statValue {
            font-weight: bold;
            color: #ff6a88;
            font-size: 14px;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        #controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 12px;
            z-index: 40;
        }
        
        .controlButton {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15),
                        inset 0 -2px 5px rgba(0, 0, 0, 0.05),
                        inset 0 2px 5px rgba(255, 255, 255, 0.8);
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        
        .controlButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15),
                        inset 0 -2px 5px rgba(0, 0, 0, 0.05),
                        inset 0 2px 5px rgba(255, 255, 255, 0.8);
        }
        
        .controlButton:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1),
                        inset 0 -1px 3px rgba(0, 0, 0, 0.05),
                        inset 0 1px 3px rgba(255, 255, 255, 0.8);
        }
        
        /* è¶…çº§æ¨¡å¼æŒ‡ç¤ºå™¨ */
        .superModeIndicator {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff9a8b 0%, #ff0844 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 8, 68, 0.5);
            z-index: 30;
            animation: pulseIndicator 1.5s infinite;
        }
        
        @keyframes pulseIndicator {
            0% {
                transform: translateX(-50%) scale(1);
            }
            50% {
                transform: translateX(-50%) scale(1.05);
            }
            100% {
                transform: translateX(-50%) scale(1);
            }
        }
        
        /* å£°æ³¢åŠ¨ç”» */
        @keyframes soundWave {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        .soundWave {
            position: absolute;
            border-radius: 50%;
            border: 2px solid #ff6b6b;
            animation: soundWave 1s infinite;
            pointer-events: none;
        }
        
        /* å¼¹å‡ºæ¶ˆæ¯ */
        #popupMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 18px;
            z-index: 50;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            animation: popupFade 0.3s ease-out;
        }
        
        @keyframes popupFade {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        
        /* æˆå°±ç³»ç»Ÿæ ·å¼ */
        #achievementPopup {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, 0);
            background: linear-gradient(135deg, #ff9a8b 0%, #ff6a88 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            z-index: 51;
            display: none;
            box-shadow: 0 15px 35px rgba(255, 106, 136, 0.4);
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: achievementSlide 0.5s ease-out;
        }
        
        @keyframes achievementSlide {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        #achievementPopup .achievementTitle {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        #achievementPopup .achievementDesc {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* é«˜çº§ç‰¹æ•ˆæ ·å¼ */
        .neonParticle {
            position: absolute;
            border-radius: 50%;
            filter: blur(2px);
            box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }
        
        .textEffect {
            position: absolute;
            font-weight: bold;
            text-shadow: 0 0 10px currentColor;
            animation: textFade 1.5s forwards;
        }
        
        @keyframes textFade {
            0% {
                opacity: 0;
                transform: scale(0.8) rotate(0deg);
            }
            20% {
                opacity: 1;
                transform: scale(1.1) rotate(3deg);
            }
            80% {
                opacity: 1;
                transform: scale(1.1) rotate(-3deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.9) translateY(10px) rotate(0deg);
            }
        }
        
        .shockwave {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
            opacity: 0.8;
            animation: shockwaveExpand 0.8s forwards;
            pointer-events: none;
        }
        
        @keyframes shockwaveExpand {
            0% {
                transform: scale(0);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }
        
        /* èƒŒæ™¯é¢œè‰²æ¸å˜åŠ¨ç”» */
        @keyframes bgColorShift {
            0% {
                background-color: rgba(255, 0, 0, 0.05);
            }
            20% {
                background-color: rgba(255, 165, 0, 0.05);
            }
            40% {
                background-color: rgba(255, 255, 0, 0.05);
            }
            60% {
                background-color: rgba(0, 128, 0, 0.05);
            }
            80% {
                background-color: rgba(0, 0, 255, 0.05);
            }
            100% {
                background-color: rgba(128, 0, 128, 0.05);
            }
        }
        
        /* æ–°ç‰¹æ•ˆæ ·å¼ */
        .emojiExplosion {
            position: absolute;
            font-size: 30px;
            animation: emojiFloat 3s forwards;
            z-index: 6;
        }
        
        @keyframes emojiFloat {
            0% {
                transform: translateY(0) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: translateY(-10px) rotate(5deg) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(-100px) rotate(-5deg) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-120px) rotate(0deg) scale(0.8);
            }
        }
        
        /* å“åº”å¼é€‚é…ä¸åŒè®¾å¤‡å°ºå¯¸ */
        @media (max-height: 600px) {
            #mouthButton {
                width: 100px;
                height: 100px;
                font-size: 50px;
            }
            
            #checkinPanel {
                max-height: 30%;
            }
            
            .statItem {
                padding: 5px 3px;
            }
            
            .statLabel {
                font-size: 10px;
            }
        }
        
        @media (max-width: 360px) {
            #mouthButton {
                width: 90px;
                height: 90px;
                font-size: 45px;
            }
            
            .checkinGrid {
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
            }
            
            .checkinDay {
                font-size: 12px;
            }
            
            #controls {
                gap: 8px;
            }
            
            .controlButton {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameHeader">å°–å«çˆ†å‘å™¨Plusç‰ˆ</div>
        
        <div id="gameplayArea">
            <div id="mouthButton">ğŸ˜®</div>
            <div id="effectsContainer"></div>
        </div>
        
        <div id="pressureMeter">
            <div id="pressureBar"></div>
            <div id="pressureValue">0</div>
        </div>
        
        <div id="checkinPanel">
            <div class="checkinHeader">
                æœ¬æœˆæœ€é«˜é‡Šæ”¾å€¼: <span id="monthMax">0</span>
            </div>
            <div id="statsContainer">
                <div class="statItem">
                    <div class="statLabel">ç´¯è®¡é‡Šæ”¾</div>
                    <div class="statValue" id="totalPressureReleased">0</div>
                </div>
                <div class="statItem">
                    <div class="statLabel">å†å²æœ€é«˜</div>
                    <div class="statValue" id="allTimeMax">0</div>
                </div>
                <div class="statItem">
                    <div class="statLabel">æœ¬å‘¨é‡Šæ”¾</div>
                    <div class="statValue" id="weeklyTotal">0</div>
                </div>
            </div>
            <div class="checkinGrid" id="checkinGrid"></div>
        </div>
        
        <div id="controls">
            <div class="controlButton" id="toggleCheckin">ğŸ“…</div>
            <div class="controlButton" id="toggleEffects">âœ¨</div>
            <div class="controlButton" id="toggleSuper">ğŸ”¥</div>
            <div class="controlButton" id="toggleSound">ğŸ”Š</div>
        </div>
    </div>
    
    <div id="popupMessage"></div>
    <div id="achievementPopup">
        <div class="achievementTitle">æ–°æˆå°±è§£é”ï¼</div>
        <div class="achievementDesc"></div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            isPressed: false,
            pressStartTime: 0,
            currentPressure: 0,
            maxPressure: 0,
            lastPressureUpdate: 0,
            pressureIncreaseRate: 2, // æ¯100mså¢åŠ çš„åŸºç¡€ç™¾åˆ†æ¯”
            pressureTier: 0, // å‹åŠ›ç­‰çº§ï¼Œå½±å“è§†è§‰æ•ˆæœ
            effectsEnabled: true,
            soundEnabled: true,
            checkinVisible: false,
            particles: [],
            soundWaves: [],
            neonParticles: [],
            textEffects: [],
            shockwaves: [],
            maxParticles: 300, // å¢åŠ æ€§èƒ½é™åˆ¶
            touchType: '', // 'short', 'long', æˆ– 'rapid'
            rapidPressCount: 0,
            rapidPressTimeout: null,
            animationFrameId: null,
            lastFrame: 0,
            superModeActive: false,
            superModeTimer: null,
            achievements: [], // æˆå°±ç³»ç»Ÿ
            totalPressureReleased: 0, // ç´¯è®¡é‡Šæ”¾å‹åŠ›
            sessionStartTime: Date.now(), // æœ¬æ¬¡ä¼šè¯å¼€å§‹æ—¶é—´
            customEffectsUnlocked: [], // è§£é”çš„è‡ªå®šä¹‰æ•ˆæœ
            backgroundAnimationActive: false
        };
        
        // æˆå°±å®šä¹‰
        const achievements = [
            { id: 'first-scream', title: 'åˆæ¬¡å°–å«', description: 'å®Œæˆä½ çš„ç¬¬ä¸€æ¬¡å°–å«', unlockAt: 1, type: 'pressure', unlocked: false },
            { id: 'pressure-100', title: 'è§£å‹é«˜æ‰‹', description: 'è¾¾åˆ°100ç‚¹å‹åŠ›å€¼', unlockAt: 100, type: 'pressure', unlocked: false },
            { id: 'pressure-500', title: 'å°–å«ä¹‹ç‹', description: 'è¾¾åˆ°500ç‚¹å‹åŠ›å€¼', unlockAt: 500, type: 'pressure', unlocked: false },
            { id: 'pressure-1000', title: 'å‹åŠ›é‡Šæ”¾å¤§å¸ˆ', description: 'è¾¾åˆ°1000ç‚¹å‹åŠ›å€¼', unlockAt: 1000, type: 'pressure', unlocked: false },
            { id: 'total-pressure-5000', title: 'æŒç»­å‡å‹', description: 'ç´¯è®¡é‡Šæ”¾5000ç‚¹å‹åŠ›', unlockAt: 5000, type: 'totalPressure', unlocked: false },
            { id: 'rapid-master', title: 'å¿«é€ŸæŒ‰å‹ä¸“å®¶', description: 'å®Œæˆ10æ¬¡å¿«é€ŸæŒ‰å‹', unlockAt: 10, type: 'rapidPress', unlocked: false },
            { id: 'daily-3', title: 'åšæŒä¸æ‡ˆ', description: 'è¿ç»­3å¤©æ‰“å¡', unlockAt: 3, type: 'consecutive', unlocked: false },
            { id: 'super-mode', title: 'è¶…çº§æ¨¡å¼', description: 'è§£é”è¶…çº§é‡Šæ”¾æ¨¡å¼', unlockAt: 300, type: 'pressure', unlocked: false }
        ];
        
        // è‡ªå®šä¹‰æ•ˆæœå®šä¹‰
        const customEffects = [
            { id: 'neon-explosion', name: 'éœ“è™¹çˆ†ç‚¸', unlockAt: 200, type: 'pressure', enabled: false },
            { id: 'text-shower', name: 'æ–‡å­—é›¨', unlockAt: 300, type: 'pressure', enabled: false },
            { id: 'color-shift', name: 'é¢œè‰²å˜æ¢', unlockAt: 500, type: 'pressure', enabled: false },
            { id: 'shockwave', name: 'å†²å‡»æ³¢', unlockAt: 400, type: 'pressure', enabled: false }
        ];
        
        // DOMå…ƒç´ 
        const mouthButton = document.getElementById('mouthButton');
        const effectsContainer = document.getElementById('effectsContainer');
        const pressureBar = document.getElementById('pressureBar');
        const pressureValue = document.getElementById('pressureValue');
        const checkinPanel = document.getElementById('checkinPanel');
        const checkinGrid = document.getElementById('checkinGrid');
        const monthMax = document.getElementById('monthMax');
        const popupMessage = document.getElementById('popupMessage');
        const toggleCheckin = document.getElementById('toggleCheckin');
        const toggleEffects = document.getElementById('toggleEffects');
        const toggleSuper = document.getElementById('toggleSuper');
        const toggleSound = document.getElementById('toggleSound');
        
        // æ£€æŸ¥å­˜å‚¨æ˜¯å¦å¯ç”¨
        function storageAvailable(type) {
            try {
                const storage = window[type];
                const x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return true;
            } catch (e) {
                return false;
            }
        }
        
        // æœ¬åœ°å­˜å‚¨åŠŸèƒ½
        function saveCheckin(pressure) {
            if (!storageAvailable('localStorage')) return;
            
            const today = new Date();
            const dateKey = today.toISOString().split('T')[0]; // YYYY-MM-DD
            const monthKey = dateKey.substring(0, 7); // YYYY-MM
            const weekStart = getWeekStart(today).toISOString().split('T')[0]; // æœ¬å‘¨å¼€å§‹æ—¥æœŸ
            
            // è·å–ç°æœ‰æ•°æ®
            let checkinData = JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
            let statsData = JSON.parse(localStorage.getItem('screamStatsData') || '{}');
            
            // æ›´æ–°ä»Šå¤©çš„æ•°æ®
            if (!checkinData[dateKey] || pressure > checkinData[dateKey]) {
                checkinData[dateKey] = pressure;
            }
            
            // æ›´æ–°å†å²æœ€é«˜å€¼
            if (!statsData.allTimeMax || pressure > statsData.allTimeMax) {
                statsData.allTimeMax = pressure;
            }
            
            // æ›´æ–°æœˆæœ€å¤§å€¼
            let monthMaxValue = 0;
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // æ›´æ–°æœ¬å‘¨ç´¯è®¡é‡Šæ”¾å€¼
            if (!statsData.weeklyData) {
                statsData.weeklyData = {};
            }
            
            if (!statsData.weeklyData[weekStart]) {
                statsData.weeklyData[weekStart] = pressure;
            } else {
                // å¦‚æœä»Šå¤©å·²ç»è®°å½•è¿‡ï¼Œåˆ™åªåŠ ä¸Šå·®å€¼
                const oldValue = checkinData[dateKey] || 0;
                const diff = Math.max(pressure - oldValue, 0);
                statsData.weeklyData[weekStart] += diff;
            }
            
            // æ›´æ–°ç´¯è®¡é‡Šæ”¾æ€»å€¼
            if (!statsData.totalReleased) {
                statsData.totalReleased = pressure;
            } else {
                // å¦‚æœä»Šå¤©å·²ç»è®°å½•è¿‡ï¼Œåˆ™åªåŠ ä¸Šå·®å€¼
                const oldValue = checkinData[dateKey] || 0;
                const diff = Math.max(pressure - oldValue, 0);
                statsData.totalReleased += diff;
            }
            
            // æ£€æŸ¥è¿ç»­æ‰“å¡
            if (!statsData.consecutiveDays) {
                statsData.consecutiveDays = 1;
                statsData.lastCheckin = dateKey;
            } else {
                const lastDate = new Date(statsData.lastCheckin);
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastDate.toISOString().split('T')[0] === yesterday.toISOString().split('T')[0]) {
                    // æ˜¨å¤©æ‰“è¿‡å¡ï¼Œè¿ç»­å¤©æ•°+1
                    statsData.consecutiveDays++;
                    statsData.lastCheckin = dateKey;
                    
                    // æ£€æŸ¥è¿ç»­æ‰“å¡æˆå°±
                    if (statsData.consecutiveDays === 3) {
                        const achievement = achievements.find(a => a.id === 'daily-3');
                        if (achievement && !achievement.unlocked) {
                            achievement.unlocked = true;
                            showAchievement(achievement.title, achievement.description);
                            saveAchievements();
                        }
                    }
                } else if (lastDate.toISOString().split('T')[0] !== dateKey) {
                    // ä¸æ˜¯æ˜¨å¤©ä¹Ÿä¸æ˜¯ä»Šå¤©ï¼Œé‡ç½®è¿ç»­å¤©æ•°
                    statsData.consecutiveDays = 1;
                    statsData.lastCheckin = dateKey;
                }
            }
            
            // ä¿å­˜æ•°æ®
            localStorage.setItem('screamCheckinData', JSON.stringify(checkinData));
            localStorage.setItem('screamStatsData', JSON.stringify(statsData));
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            gameState.totalPressureReleased = statsData.totalReleased || 0;
            
            // æ›´æ–°UI
            updateCheckinDisplay();
        }
        
        function loadCheckinData() {
            if (!storageAvailable('localStorage')) return {};
            
            return JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
        }
        
        // è·å–æœ¬å‘¨å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼‰
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // è°ƒæ•´ä¸ºå‘¨ä¸€
            return new Date(d.setDate(diff));
        }
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStatsData() {
            if (!storageAvailable('localStorage')) return {};
            
            return JSON.parse(localStorage.getItem('screamStatsData') || '{}');
        }
        
        function updateCheckinDisplay() {
            // æ¸…é™¤ç°æœ‰ç½‘æ ¼
            checkinGrid.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // æœˆä»½ç¬¬ä¸€å¤©
            const firstDay = new Date(currentYear, currentMonth, 1);
            // æœˆä»½æœ€åä¸€å¤©
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            
            // ç¬¬ä¸€å¤©çš„æ˜ŸæœŸï¼ˆ0=å‘¨æ—¥ï¼Œ6=å‘¨å…­ï¼‰
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // åˆ›å»ºæ˜ŸæœŸæ ‡é¢˜ï¼ˆå‘¨æ—¥-å‘¨å…­ï¼‰
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'checkinDay';
                dayHeader.style.backgroundColor = '#ddd';
                dayHeader.textContent = day;
                checkinGrid.appendChild(dayHeader);
            });
            
            // ä¸ºæœˆä»½ç¬¬ä¸€å¤©ä¹‹å‰æ·»åŠ ç©ºå•å…ƒæ ¼
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'checkinDay';
                emptyDay.style.visibility = 'hidden';
                checkinGrid.appendChild(emptyDay);
            }
            
            // è·å–æ‰“å¡æ•°æ®
            const checkinData = loadCheckinData();
            
            // è·å–ç»Ÿè®¡æ•°æ®
            const statsData = loadStatsData();
            
            // è®¡ç®—æœˆæœ€å¤§å€¼
            let monthMaxValue = 0;
            const monthKey = today.toISOString().substring(0, 7); // YYYY-MM
            
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // æ›´æ–°æœˆæœ€å¤§å€¼æ˜¾ç¤º
            monthMax.textContent = monthMaxValue.toFixed(0);
            
            // æ›´æ–°å…¶ä»–ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
            document.getElementById('totalPressureReleased').textContent = 
                (statsData.totalReleased || 0).toFixed(0);
            
            document.getElementById('allTimeMax').textContent = 
                (statsData.allTimeMax || 0).toFixed(0);
            
            // è®¡ç®—æœ¬å‘¨é‡Šæ”¾æ€»å€¼
            const weekStart = getWeekStart(today).toISOString().split('T')[0];
            document.getElementById('weeklyTotal').textContent = 
                ((statsData.weeklyData && statsData.weeklyData[weekStart]) || 0).toFixed(0);
            
            // æ·»åŠ æœˆä»½çš„å¤©æ•°
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'checkinDay';
                dayCell.textContent = i;
                
                // æ£€æŸ¥è¿™ä¸€å¤©æ˜¯å¦æœ‰æ‰“å¡
                const dateString = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                
                if (checkinData[dateString]) {
                    dayCell.classList.add('active');
                    
                    // æ·»åŠ å‹åŠ›å€¼
                    const valueSpan = document.createElement('div');
                    valueSpan.className = 'checkinValue';
                    valueSpan.textContent = checkinData[dateString].toFixed(0);
                    dayCell.appendChild(valueSpan);
                    
                    // å¦‚æœæ˜¯å†å²æœ€é«˜å€¼ï¼Œæ·»åŠ ç‰¹æ®Šæ ‡è®°
                    if (checkinData[dateString] === statsData.allTimeMax) {
                        dayCell.style.boxShadow = '0 0 8px rgba(255, 8, 68, 0.7)';
                        dayCell.style.background = 'linear-gradient(135deg, #ff6a88 0%, #ff0844 100%)';
                    }
                }
                
                // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ·»åŠ ç‰¹æ®Šæ ‡è®°
                if (i === today.getDate()) {
                    dayCell.style.border = '2px solid #ff9a8b';
                }
                
                checkinGrid.appendChild(dayCell);
            }
        }
        
        // ç‰¹æ•ˆç”ŸæˆåŠŸèƒ½
        function createParticle(pressure) {
            if (!gameState.effectsEnabled || gameState.particles.length >= gameState.maxParticles) return;
            
            // åˆ›å»ºç²’å­å…ƒç´ 
            const particle = document.createElement('div');
            particle.style.position = 'absolute';
            particle.style.pointerEvents = 'none';
            
            // åœ¨æŒ‰é’®å‘¨å›´éšæœºå®šä½
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            
            // æ ¹æ®å‹åŠ›è°ƒæ•´è·ç¦»å’Œæ•ˆæœ
            let distance, content, fontSize, color, duration, directionX, directionY;
            
            // è¶…çº§æ¨¡å¼å¢å¼ºæ•ˆæœ
            const superMultiplier = gameState.superModeActive ? 1.5 : 1;
            
            // éšç€å‹åŠ›å€¼å¢å¤§ï¼ŒåŠ¨æ€å¢åŠ ç²’å­å¤æ‚åº¦
            if (pressure < 50) {
                // ä½å‹åŠ›ï¼šç®€å•æ–‡æœ¬
                distance = 50 + (Math.random() * pressure * 1.8);
                
                const options = ['a', 'ã‚', 'å•Š', 'ì•„', '!', '?', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜£', 'oh', 'Ah'];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = (12 + Math.random() * 10) * superMultiplier;
                
                const hue = Math.floor(180 + Math.random() * 60); // è“è‰²-é’è‰²èŒƒå›´
                color = `hsl(${hue}, 80%, 60%)`;
                
                duration = 1000 + Math.random() * 1000;
                directionX = (Math.random() - 0.5) * (pressure / 15);
                directionY = (Math.random() - 0.5 - 0.3) * (pressure / 12);
            } else if (pressure < 150) {
                // ä¸­ç­‰å‹åŠ›ï¼šæ›´å…·è¡¨ç°åŠ›
                distance = 60 + (Math.random() * pressure * 2);
                
                const options = [
                    'AA', 'ã‚ã‚', 'å•Šå•Š', 'ì•„ì•„', '!!', '?!', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ˜±', 'ğŸ˜«',
                    'OH', 'AHH', 'WOW', 'GAH', 'EEK', 'AGHH'
                ];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = (16 + Math.random() * 14) * superMultiplier;
                
                const hue = Math.floor(280 + Math.random() * 60); // ç´«è‰²-æ´‹çº¢è‰²èŒƒå›´
                color = `hsl(${hue}, 85%, 65%)`;
                
                duration = 1200 + Math.random() * 1000;
                directionX = (Math.random() - 0.5) * (pressure / 12);
                directionY = (Math.random() - 0.5 - 0.4) * (pressure / 10);
            } else if (pressure < 500) {
                // é«˜å‹åŠ›ï¼šå¼ºçƒˆè¡¨è¾¾
                distance = 70 + (Math.random() * pressure * 2.2);
                
                const options = [
                    'AAA!', 'ã‚ã‚ã‚!!!', 'å•Šå•Šå•Š!!!', 'ì•„ì•„ì•„!!!', '!!!', '?!!?!', 
                    'ğŸ˜±', 'ğŸ˜«', 'ğŸ˜–', 'ğŸ˜µ', 'ğŸ˜¨', 'ğŸ’¥', 'ğŸ’«', 'ğŸ’¢', 'âš¡',
                    'AHHH!', 'WOAH!', 'EEEK!', 'ARGH!', 'GYAH!'
                ];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = (20 + Math.random() * 18) * superMultiplier;
                
                const hue = Math.floor(320 + Math.random() * 40) % 360; // æ´‹çº¢è‰²-çº¢è‰²èŒƒå›´
                color = `hsl(${hue}, 90%, 60%)`;
                
                duration = 1400 + Math.random() * 1200;
                directionX = (Math.random() - 0.5) * (pressure / 8);
                directionY = (Math.random() - 0.5 - 0.5) * (pressure / 7);
            } else {
                // æé™å‹åŠ›ï¼šç–¯ç‹‚çˆ†å‘
                distance = 80 + (Math.random() * pressure * 2.5);
                
                const options = [
                    'AAAAH!!!', 'ã‚ã‚ã‚ã‚ã‚!!!!', 'å•Šå•Šå•Šå•Šå•Š!!!!', 'ì•„ì•„ì•„ì•„ì•„!!!!', 
                    '!!!!!!!', '?!!?!?!!', 'ğŸ˜±ğŸ˜±ğŸ˜±', 'ğŸ˜«ğŸ˜«', 'ğŸ˜–ğŸ˜–ğŸ˜–', 'âš¡ğŸ’¥âš¡',
                    'AHHHHH!!!', 'WOAAAH!!!', 'EEEEEK!!!', 'ARRRGH!!!'
                ];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = (24 + Math.random() * 24) * superMultiplier;
                
                // éšæœºäº®è‰²
                const hue = Math.floor(Math.random() * 360);
                color = `hsl(${hue}, 100%, 65%)`;
                
                duration = 1800 + Math.random() * 1500;
                directionX = (Math.random() - 0.5) * (pressure / 6) * superMultiplier;
                directionY = (Math.random() - 0.5 - 0.6) * (pressure / 5) * superMultiplier;
            }
            
            const posX = centerX + Math.cos(angle) * distance;
            const posY = centerY + Math.sin(angle) * distance;
            
            particle.style.left = posX + 'px';
            particle.style.top = posY + 'px';
            
            // åº”ç”¨æ ·å¼
            particle.textContent = content;
            particle.style.fontSize = fontSize + 'px';
            particle.style.color = color;
            particle.style.opacity = '0.9';
            particle.style.transform = 'rotate(' + (Math.random() * 40 - 20) + 'deg)';
            particle.style.textShadow = `0 0 5px ${color}, 0 0 10px rgba(255, 255, 255, 0.5)`;
            
            // è¶…çº§æ¨¡å¼ç‰¹æ•ˆ
            if (gameState.superModeActive && Math.random() > 0.7) {
                particle.style.fontWeight = 'bold';
                particle.style.border = `1px solid ${color}`;
                particle.style.padding = '2px 6px';
                particle.style.borderRadius = '8px';
                particle.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
            }
            
            // æ·»åŠ åˆ°DOM
            effectsContainer.appendChild(particle);
            
            // æ·»åŠ åˆ°ç²’å­æ•°ç»„
            gameState.particles.push({
                element: particle,
                posX,
                posY,
                directionX,
                directionY,
                rotation: (Math.random() - 0.5) * 15 * superMultiplier,
                opacity: 0.95,
                duration,
                elapsed: 0,
                color
            });
        }
        
        function createSoundWave(pressure) {
            if (!gameState.effectsEnabled) return;
            
            const wave = document.createElement('div');
            wave.className = 'soundWave';
            
            const size = 80 + pressure * 1.5;
            wave.style.width = size + 'px';
            wave.style.height = size + 'px';
            
            // å±…ä¸­å®šä½
            wave.style.left = 'calc(50% - ' + (size / 2) + 'px)';
            wave.style.top = 'calc(50% - ' + (size / 2) + 'px)';
            
            // åŸºäºå‹åŠ›çš„åŠ¨ç”»æŒç»­æ—¶é—´
            const duration = 1000 - (pressure * 5); // å‹åŠ›è¶Šé«˜è¶Šå¿«
            wave.style.animationDuration = Math.max(duration, 300) + 'ms';
            
            // æ·»åŠ åˆ°DOM
            effectsContainer.appendChild(wave);
            
            // æ·»åŠ åˆ°æ³¢æ•°ç»„
            gameState.soundWaves.push({
                element: wave,
                duration: Math.max(duration, 300),
                elapsed: 0
            });
        }
        
        // åˆ›å»ºéœ“è™¹ç²’å­ç‰¹æ•ˆ
        function createNeonParticle(pressure) {
            if (!gameState.effectsEnabled || !gameState.customEffectsUnlocked.includes('neon-explosion')) return;
            
            const particle = document.createElement('div');
            particle.className = 'neonParticle';
            
            // éšæœºé¢œè‰²
            const hues = [0, 60, 120, 180, 240, 300]; // çº¢ã€é»„ã€ç»¿ã€é’ã€è“ã€æ´‹çº¢
            const hue = hues[Math.floor(Math.random() * hues.length)];
            const color = `hsl(${hue}, 100%, 70%)`;
            particle.style.backgroundColor = color;
            particle.style.color = color;
            
            // å¤§å°åŸºäºå‹åŠ›
            const size = 5 + (Math.random() * pressure / 10);
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            
            // ä½ç½®å’ŒåŠ¨ç”»
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            const distance = 10 + (Math.random() * pressure);
            
            const posX = centerX + Math.cos(angle) * distance;
            const posY = centerY + Math.sin(angle) * distance;
            
            particle.style.left = posX + 'px';
            particle.style.top = posY + 'px';
            
            // åŠ¨ç”»å‚æ•°
            const duration = 1000 + Math.random() * 2000;
            const directionX = (Math.random() - 0.5) * pressure / 10;
            const directionY = (Math.random() - 0.5) * pressure / 10;
            const gravity = 0.05 + Math.random() * 0.1;
            
            effectsContainer.appendChild(particle);
            
            gameState.neonParticles.push({
                element: particle,
                posX,
                posY,
                directionX,
                directionY,
                gravity,
                opacity: 1,
                duration,
                elapsed: 0,
                size
            });
        }
        
        // åˆ›å»ºæ–‡å­—æ¼‚æµ®ç‰¹æ•ˆ
        function createTextEffect(pressure) {
            if (!gameState.effectsEnabled || !gameState.customEffectsUnlocked.includes('text-shower')) return;
            
            const textEffect = document.createElement('div');
            textEffect.className = 'textEffect';
            
            // éšæœºä½ç½®
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const posX = Math.random() * screenWidth * 0.8 + screenWidth * 0.1;
            const posY = Math.random() * screenHeight * 0.6 + screenHeight * 0.2;
            
            textEffect.style.left = posX + 'px';
            textEffect.style.top = posY + 'px';
            
            // éšæœºé¢œè‰²å’Œå¤§å°
            const hue = Math.floor(Math.random() * 360);
            const color = `hsl(${hue}, 100%, 60%)`;
            textEffect.style.color = color;
            
            const fontSize = 18 + Math.floor(Math.random() * 24);
            textEffect.style.fontSize = `${fontSize}px`;
            
            // éšæœºè§’åº¦
            const rotate = Math.random() * 30 - 15;
            textEffect.style.transform = `rotate(${rotate}deg)`;
            
            // æ–‡å­—å†…å®¹
            const texts = [
                'é‡Šæ”¾å‹åŠ›!', 'å°–å«å§!', 'æ„Ÿè§‰å¥½äº›äº†å—?', 'ç»§ç»­!',
                'é‡Šæ”¾!', 'çˆ†å‘!', 'å°–å«!', 'å‘å–Š!',
                'âœ¨æ”¾æ¾âœ¨', 'æ²»æ„ˆä¸­...', 'å‹åŠ›-100', 'èˆ’é€‚+1',
                pressure > 300 ? 'å¤ªå‰å®³äº†!' : 'åŠ æ²¹!',
                pressure > 500 ? 'å°–å«ä¹‹ç‹!' : 'ç»§ç»­å°–å«!',
                'âœ¨âœ¨âœ¨'
            ];
            
            textEffect.textContent = texts[Math.floor(Math.random() * texts.length)];
            
            effectsContainer.appendChild(textEffect);
            
            // æ–‡å­—æ•ˆæœä¸éœ€è¦æ·»åŠ åˆ°æ•°ç»„ä¸­æ›´æ–°ï¼Œå®ƒä½¿ç”¨CSSåŠ¨ç”»
            setTimeout(() => {
                textEffect.remove();
            }, 1500);
        }
        
        // åˆ›å»ºå†²å‡»æ³¢ç‰¹æ•ˆ
        function createShockwave(pressure) {
            if (!gameState.effectsEnabled || !gameState.customEffectsUnlocked.includes('shockwave')) return;
            
            const shockwave = document.createElement('div');
            shockwave.className = 'shockwave';
            
            // ä¸­å¿ƒä½ç½®
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // å¤§å°æ¯”ä¾‹
            const maxRadius = Math.min(window.innerWidth, window.innerHeight) * 0.8;
            
            shockwave.style.left = (centerX - maxRadius / 2) + 'px';
            shockwave.style.top = (centerY - maxRadius / 2) + 'px';
            shockwave.style.width = maxRadius + 'px';
            shockwave.style.height = maxRadius + 'px';
            
            effectsContainer.appendChild(shockwave);
            
            // ä½¿ç”¨CSSåŠ¨ç”»ï¼Œä¸éœ€è¦æ·»åŠ åˆ°æ•°ç»„
            setTimeout(() => {
                shockwave.remove();
            }, 800);
        }
        
        // åˆ›å»ºè¡¨æƒ…ç¬¦å·çˆ†ç‚¸
        function createEmojiExplosion(pressure) {
            if (!gameState.effectsEnabled) return;
            
            // åŸºäºå‹åŠ›å†³å®šè¡¨æƒ…æ•°é‡
            const count = Math.min(Math.floor(pressure / 50) + 3, 15);
            
            const emojis = [
                'ğŸ˜±', 'ğŸ˜²', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜«', 'ğŸ˜–', 'ğŸ˜µ', 
                'ğŸ’¥', 'âš¡', 'ğŸ’¢', 'ğŸ’«', 'âœ¨', 'ğŸ’¦', 'ğŸŒŸ',
                'ğŸ”¥', 'â­', 'ğŸ’¯', 'ğŸ‰', 'ğŸŠ', 'ğŸ’¨'
            ];
            
            for (let i = 0; i < count; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emojiExplosion';
                
                // éšæœºè¡¨æƒ…
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                
                // éšæœºä½ç½® (ä»ä¸­å¿ƒç‚¹å‘æ•£)
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const angle = Math.random() * Math.PI * 2;
                const distance = 40 + Math.random() * 100;
                
                const posX = centerX + Math.cos(angle) * distance;
                const posY = centerY + Math.sin(angle) * distance;
                
                emoji.style.left = posX + 'px';
                emoji.style.top = posY + 'px';
                
                // éšæœºå¤§å°
                const size = 100 + Math.random() * 100;
                emoji.style.fontSize = `${size}%`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                emoji.style.animationDelay = `${Math.random() * 0.5}s`;
                
                effectsContainer.appendChild(emoji);
                
                // æ¸…ç†
                setTimeout(() => {
                    emoji.remove();
                }, 3000);
            }
        }
        
        function applyScreenShake(pressure) {
            if (!gameState.effectsEnabled || pressure < 40) return;
            
            const intensity = pressure / 10;
            const gameContainer = document.getElementById('gameContainer');
            
            // æ¸…é™¤ç°æœ‰çš„æŠ–åŠ¨
            gameContainer.style.transform = 'none';
            
            // æŠ–åŠ¨æ•ˆæœçš„éšæœºä½ç½®
            const shakeX = (Math.random() - 0.5) * intensity;
            const shakeY = (Math.random() - 0.5) * intensity;
            
            gameContainer.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
            
            // çŸ­æš‚å»¶è¿Ÿåé‡ç½®
            setTimeout(() => {
                gameContainer.style.transform = 'none';
            }, 50);
        }
        
        function updateVisualEffects(deltaTime) {
            // æ›´æ–°æ ‡å‡†ç²’å­
            for (let i = gameState.particles.length - 1; i >= 0; i--) {
                const particle = gameState.particles[i];
                particle.elapsed += deltaTime;
                
                if (particle.elapsed >= particle.duration) {
                    // ç§»é™¤è¿‡æœŸç²’å­
                    particle.element.remove();
                    gameState.particles.splice(i, 1);
                } else {
                    // æ›´æ–°ä½ç½®
                    particle.posX += particle.directionX * deltaTime * 0.1;
                    particle.posY += particle.directionY * deltaTime * 0.1;
                    
                    // æ›´æ–°ä¸é€æ˜åº¦
                    const progress = particle.elapsed / particle.duration;
                    particle.opacity = 0.95 * (1 - progress);
                    
                    // æ·»åŠ è½»å¾®çš„åŠ¨æ€æ•ˆæœ - è¶…çº§æ¨¡å¼æ—¶æ›´å¼º
                    const wobble = gameState.superModeActive ? 
                        Math.sin(progress * 10) * 3 : 
                        Math.sin(progress * 6) * 1.5;
                    
                    // åº”ç”¨æ›´æ–°
                    particle.element.style.left = particle.posX + 'px';
                    particle.element.style.top = particle.posY + 'px';
                    particle.element.style.opacity = particle.opacity;
                    
                    // éšæ—¶é—´å˜æ¢
                    const rotationAmount = particle.rotation * progress * 10;
                    const scaleEffect = 1 - progress * 0.3; // éšæ—¶é—´è½»å¾®ç¼©å°
                    
                    particle.element.style.transform = `
                        rotate(${rotationAmount + wobble}deg) 
                        scale(${scaleEffect})
                    `;
                    
                    // é¢œè‰²å˜æ¢ç‰¹æ•ˆ
                    if (gameState.customEffectsUnlocked.includes('color-shift') && Math.random() < 0.1) {
                        const hue = (parseFloat(particle.color.match(/hsl\((\d+)/)[1]) + 10) % 360;
                        const newColor = `hsl(${hue}, 85%, 60%)`;
                        particle.element.style.color = newColor;
                        particle.element.style.textShadow = `0 0 5px ${newColor}`;
                        particle.color = newColor;
                    }
                }
            }
            
            // æ›´æ–°å£°æ³¢
            for (let i = gameState.soundWaves.length - 1; i >= 0; i--) {
                const wave = gameState.soundWaves[i];
                wave.elapsed += deltaTime;
                
                if (wave.elapsed >= wave.duration) {
                    // ç§»é™¤è¿‡æœŸæ³¢
                    wave.element.remove();
                    gameState.soundWaves.splice(i, 1);
                }
            }
            
            // æ›´æ–°éœ“è™¹ç²’å­
            for (let i = gameState.neonParticles.length - 1; i >= 0; i--) {
                const particle = gameState.neonParticles[i];
                particle.elapsed += deltaTime;
                
                if (particle.elapsed >= particle.duration) {
                    particle.element.remove();
                    gameState.neonParticles.splice(i, 1);
                } else {
                    // æ›´æ–°ä½ç½®ï¼ŒåŠ å…¥é‡åŠ›å’Œé˜»å°¼æ•ˆæœ
                    particle.directionY += particle.gravity * (deltaTime / 16); // é‡åŠ›
                    
                    particle.posX += particle.directionX * (deltaTime / 16) * 3;
                    particle.posY += particle.directionY * (deltaTime / 16) * 3;
                    
                    // éšæ—¶é—´å˜åŒ–å¤§å°å’Œä¸é€æ˜åº¦
                    const progress = particle.elapsed / particle.duration;
                    particle.opacity = 1 - progress;
                    
                    const currentSize = particle.size * (1 - progress * 0.7);
                    
                    // åº”ç”¨æ›´æ–°
                    particle.element.style.left = particle.posX + 'px';
                    particle.element.style.top = particle.posY + 'px';
                    particle.element.style.opacity = particle.opacity;
                    particle.element.style.width = currentSize + 'px';
                    particle.element.style.height = currentSize + 'px';
                }
            }
            
            // æ›´æ–°èƒŒæ™¯é¢œè‰²åŠ¨ç”»ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (gameState.backgroundAnimationActive && gameState.currentPressure > 300) {
                if (Math.random() < 0.05) { // éšæœºæ”¹å˜èƒŒæ™¯é¢œè‰²
                    const body = document.body;
                    body.style.animation = 'none';
                    void body.offsetWidth; // è§¦å‘å›æµ
                    body.style.animation = 'bgColorShift 3s infinite';
                }
            }
        }
        
        // è§¦æ‘¸äº‹ä»¶å¤„ç†ç¨‹åº
        function handleTouchStart(e) {
            e.preventDefault();
            if (gameState.isPressed) return;
            
            gameState.isPressed = true;
            gameState.pressStartTime = Date.now();
            gameState.currentPressure = 0;
            gameState.lastPressureUpdate = Date.now();
            
            // å¤„ç†å¿«é€ŸæŒ‰å‹æ£€æµ‹
            if (gameState.rapidPressTimeout) {
                clearTimeout(gameState.rapidPressTimeout);
                gameState.rapidPressCount++;
                
                if (gameState.rapidPressCount >= 3) {
                    gameState.touchType = 'rapid';
                    // æ”¹å˜å˜´å·´åˆ°å¿«é€Ÿæ¨¡å¼
                    mouthButton.textContent = 'ğŸ˜¬';
                }
            } else {
                gameState.rapidPressCount = 1;
            }
            
            gameState.rapidPressTimeout = setTimeout(() => {
                gameState.rapidPressCount = 0;
                gameState.rapidPressTimeout = null;
            }, 500);
            
            // ä»¥æ­£å¸¸è¡¨æƒ…å¼€å§‹
            if (gameState.touchType !== 'rapid') {
                mouthButton.textContent = 'ğŸ˜®';
            }
            
            // å¦‚æœå°šæœªè¿è¡Œï¼Œåˆ™å¯åŠ¨åŠ¨ç”»å¾ªç¯
            if (!gameState.animationFrameId) {
                gameState.lastFrame = Date.now();
                gameState.animationFrameId = requestAnimationFrame(gameLoop);
            }
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            if (!gameState.isPressed) return;
            
            gameState.isPressed = false;
            const pressDuration = Date.now() - gameState.pressStartTime;
            
            // å¦‚æœå°šæœªç¡®å®šä¸ºå¿«é€ŸæŒ‰å‹ï¼Œåˆ™ç¡®å®šæŒ‰å‹ç±»å‹
            if (gameState.touchType !== 'rapid') {
                if (pressDuration < 300) {
                    gameState.touchType = 'short';
                    mouthButton.textContent = 'ğŸ˜¯';
                } else {
                    gameState.touchType = 'long';
                    
                    // æ ¹æ®æœ€ç»ˆå‹åŠ›é‡ç½®å˜´å·´
                    if (gameState.currentPressure > 80) {
                        mouthButton.textContent = 'ğŸ˜±';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = 'ğŸ˜²';
                    } else {
                        mouthButton.textContent = 'ğŸ˜®';
                    }
                }
            }
            
            // å¤„ç†é‡Šæ”¾æ•ˆæœ
            handlePressureRelease();
            
            // å»¶è¿Ÿåé‡ç½®
            setTimeout(() => {
                mouthButton.textContent = 'ğŸ˜®';
                gameState.touchType = '';
                gameState.currentPressure = 0;
                updatePressureDisplay();
            }, 1000);
        }
        
        function handlePressureRelease() {
            // ä¿å­˜è¾¾åˆ°çš„æœ€å¤§å‹åŠ›
            const finalPressure = gameState.currentPressure;
            gameState.maxPressure = Math.max(gameState.maxPressure, finalPressure);
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            gameState.totalPressureReleased += finalPressure;
            
            // æ£€æŸ¥æˆå°±è§£é”
            checkAchievements(finalPressure);
            
            // æ£€æŸ¥è‡ªå®šä¹‰æ•ˆæœè§£é”
            checkCustomEffectsUnlock(finalPressure);
            
            // ä¿å­˜æ‰“å¡
            saveCheckin(finalPressure);
            
            // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
            const messages = [
                'ä»Šæ—¥æ‰“å¡å®Œæˆï¼',
                `é‡Šæ”¾å‹åŠ›å€¼: ${Math.floor(finalPressure)}`,
                'æ„Ÿè§‰å¥½äº›äº†å—ï¼Ÿ',
                'å‹åŠ›å·²é‡Šæ”¾ï¼',
                'å°–å«çœŸç—›å¿«ï¼',
                'å¾ˆå¥½çš„é‡Šæ”¾ï¼'
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            showPopupMessage(randomMessage, 2000);
            
            // æ ¹æ®å‹åŠ›å’Œè§¦æ‘¸ç±»å‹åˆ›å»ºçˆ†å‘æ•ˆæœ
            if (gameState.effectsEnabled) {
                // åŸºç¡€æ•ˆæœ
                const isSuper = gameState.superModeActive;
                
                if (gameState.touchType === 'rapid') {
                    // å¿«é€ŸæŒ‰å‹æ•ˆæœï¼šå¤§é‡å°ç²’å­
                    const count = isSuper ? 50 : 30;
                    for (let i = 0; i < count; i++) {
                        createParticle(finalPressure);
                    }
                    
                    if (finalPressure > 200) {
                        createEmojiExplosion(finalPressure);
                    }
                } else if (gameState.touchType === 'short') {
                    // çŸ­æŒ‰æ•ˆæœï¼šå°‘é‡ä¸­ç­‰ç²’å­
                    const count = isSuper ? 20 : 10;
                    for (let i = 0; i < count; i++) {
                        createParticle(finalPressure);
                    }
                } else {
                    // é•¿æŒ‰æ•ˆæœï¼šåŸºäºå‹åŠ›
                    const scaleFactor = isSuper ? 1.5 : 1;
                    const baseCount = Math.floor((finalPressure / (isSuper ? 15 : 20)) + 5);
                    const particleCount = Math.min(baseCount, 100); // é™åˆ¶æœ€å¤§æ•°é‡é¿å…æ€§èƒ½é—®é¢˜
                    
                    // ä¸»çˆ†å‘æ•ˆæœ
                    for (let i = 0; i < particleCount; i++) {
                        createParticle(finalPressure);
                    }
                    
                    // é«˜å‹åŠ›çš„é¢å¤–æ•ˆæœ
                    if (finalPressure > 70) {
                        // åˆ›å»ºè¡¨æƒ…çˆ†å‘
                        createEmojiExplosion(finalPressure);
                        
                        // åˆ›å»ºæŒç»­çˆ†å‘çš„æ•ˆæœ
                        const burstCount = Math.min(Math.floor(finalPressure / 25), 30);
                        for (let i = 0; i < burstCount; i++) {
                            setTimeout(() => {
                                createParticle(finalPressure);
                                applyScreenShake(finalPressure);
                                
                                // ç‰¹æ®Šè§£é”çš„æ•ˆæœ
                                if (i % 3 === 0 && gameState.customEffectsUnlocked.includes('neon-explosion')) {
                                    for (let j = 0; j < 5; j++) {
                                        createNeonParticle(finalPressure);
                                    }
                                }
                                
                                if (i % 4 === 0 && gameState.customEffectsUnlocked.includes('text-shower')) {
                                    createTextEffect(finalPressure);
                                }
                                
                                if (i === 0 && gameState.customEffectsUnlocked.includes('shockwave')) {
                                    createShockwave(finalPressure);
                                }
                                
                            }, i * 50 * (isSuper ? 0.7 : 1));
                        }
                    }
                    
                    // è¶…é«˜å‹åŠ›ç‰¹æ•ˆ (500+)
                    if (finalPressure > 500) {
                        // åˆ›å»ºå¤§å‹å†²å‡»æ³¢æ•ˆæœ
                        if (gameState.customEffectsUnlocked.includes('shockwave')) {
                            for (let i = 0; i < 3; i++) {
                                setTimeout(() => {
                                    createShockwave(finalPressure);
                                }, i * 300);
                            }
                        }
                        
                        // åˆ›å»ºæ›´å¤šæ–‡å­—æ•ˆæœ
                        if (gameState.customEffectsUnlocked.includes('text-shower')) {
                            for (let i = 0; i < 5; i++) {
                                setTimeout(() => {
                                    createTextEffect(finalPressure);
                                }, i * 200);
                            }
                        }
                        
                        // ä¸´æ—¶æ¿€æ´»èƒŒæ™¯é¢œè‰²å˜åŒ–
                        if (gameState.customEffectsUnlocked.includes('color-shift')) {
                            gameState.backgroundAnimationActive = true;
                            document.body.style.animation = 'bgColorShift 3s infinite';
                            
                            setTimeout(() => {
                                gameState.backgroundAnimationActive = false;
                                document.body.style.animation = 'none';
                            }, 5000);
                        }
                    }
                }
            }
        }
        
        // æ£€æŸ¥æˆå°±è§£é”
        function checkAchievements(pressure) {
            // æ£€æŸ¥å‹åŠ›å€¼æˆå°±
            for (let achievement of achievements) {
                if (achievement.unlocked) continue;
                
                let shouldUnlock = false;
                
                if (achievement.type === 'pressure' && pressure >= achievement.unlockAt) {
                    shouldUnlock = true;
                } else if (achievement.type === 'totalPressure' && gameState.totalPressureReleased >= achievement.unlockAt) {
                    shouldUnlock = true;
                } else if (achievement.type === 'rapidPress' && gameState.touchType === 'rapid' && gameState.rapidPressCount >= achievement.unlockAt) {
                    shouldUnlock = true;
                }
                
                if (shouldUnlock) {
                    // æ ‡è®°ä¸ºå·²è§£é”
                    achievement.unlocked = true;
                    
                    // å¦‚æœæ˜¯è¶…çº§æ¨¡å¼æˆå°±ï¼Œæ¿€æ´»è¶…çº§æ¨¡å¼
                    if (achievement.id === 'super-mode') {
                        toggleSuperMode(true);
                    }
                    
                    // æ˜¾ç¤ºæˆå°±é€šçŸ¥
                    showAchievement(achievement.title, achievement.description);
                    
                    // ä¿å­˜æˆå°±çŠ¶æ€
                    saveAchievements();
                }
            }
        }
        
        // æ£€æŸ¥è‡ªå®šä¹‰æ•ˆæœè§£é”
        function checkCustomEffectsUnlock(pressure) {
            for (let effect of customEffects) {
                if (gameState.customEffectsUnlocked.includes(effect.id)) continue;
                
                if (effect.type === 'pressure' && pressure >= effect.unlockAt) {
                    // è§£é”æ–°æ•ˆæœ
                    gameState.customEffectsUnlocked.push(effect.id);
                    effect.enabled = true;
                    
                    // æ˜¾ç¤ºè§£é”é€šçŸ¥
                    showPopupMessage(`æ–°ç‰¹æ•ˆè§£é”: ${effect.name}ï¼`, 2000);
                    
                    // ä¿å­˜æ•ˆæœçŠ¶æ€
                    saveCustomEffects();
                }
            }
        }
        
        // æ˜¾ç¤ºæˆå°±é€šçŸ¥
        function showAchievement(title, description) {
            const achievementPopup = document.getElementById('achievementPopup');
            const titleElement = achievementPopup.querySelector('.achievementTitle');
            const descElement = achievementPopup.querySelector('.achievementDesc');
            
            titleElement.textContent = 'ğŸ† ' + title;
            descElement.textContent = description;
            
            achievementPopup.style.display = 'block';
            
            setTimeout(() => {
                achievementPopup.style.display = 'none';
            }, 3000);
        }
        
        // ä¿å­˜æˆå°±å’Œè‡ªå®šä¹‰æ•ˆæœçŠ¶æ€
        function saveAchievements() {
            if (!storageAvailable('localStorage')) return;
            
            localStorage.setItem('screamAchievements', JSON.stringify(
                achievements.map(a => ({ id: a.id, unlocked: a.unlocked }))
            ));
        }
        
        function saveCustomEffects() {
            if (!storageAvailable('localStorage')) return;
            
            localStorage.setItem('screamCustomEffects', JSON.stringify(
                gameState.customEffectsUnlocked
            ));
        }
        
        // åŠ è½½æˆå°±å’Œè‡ªå®šä¹‰æ•ˆæœçŠ¶æ€
        function loadAchievements() {
            if (!storageAvailable('localStorage')) return;
            
            const savedAchievements = JSON.parse(localStorage.getItem('screamAchievements') || '[]');
            
            for (let saved of savedAchievements) {
                const achievement = achievements.find(a => a.id === saved.id);
                if (achievement) {
                    achievement.unlocked = saved.unlocked;
                }
            }
        }
        
        function loadCustomEffects() {
            if (!storageAvailable('localStorage')) return;
            
            const savedEffects = JSON.parse(localStorage.getItem('screamCustomEffects') || '[]');
            gameState.customEffectsUnlocked = savedEffects;
            
            for (let effectId of savedEffects) {
                const effect = customEffects.find(e => e.id === effectId);
                if (effect) {
                    effect.enabled = true;
                }
            }
        }
        
        // è¶…çº§æ¨¡å¼å¼€å…³
        function toggleSuperMode(forceState = null) {
            // æ£€æŸ¥æ˜¯å¦å·²è§£é”è¶…çº§æ¨¡å¼
            const superModeAchievement = achievements.find(a => a.id === 'super-mode');
            if (!superModeAchievement.unlocked) {
                showPopupMessage('éœ€è¦è¾¾åˆ°300ç‚¹å‹åŠ›å€¼è§£é”è¶…çº§æ¨¡å¼', 2000);
                return;
            }
            
            // è®¾ç½®çŠ¶æ€
            if (forceState !== null) {
                gameState.superModeActive = forceState;
            } else {
                gameState.superModeActive = !gameState.superModeActive;
            }
            
            // æ›´æ–°UI
            const toggleButton = document.getElementById('toggleSuper');
            toggleButton.textContent = gameState.superModeActive ? 'ğŸ”¥' : 'ğŸ’¤';
            
            // è¶…çº§æ¨¡å¼æŒ‡ç¤ºå™¨
            let indicator = document.querySelector('.superModeIndicator');
            
            if (gameState.superModeActive) {
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'superModeIndicator';
                    indicator.textContent = 'ğŸ”¥ è¶…çº§æ¨¡å¼ ğŸ”¥';
                    document.getElementById('gameContainer').appendChild(indicator);
                }
                
                // è¶…çº§æ¨¡å¼è‡ªåŠ¨å…³é—­å®šæ—¶å™¨
                if (gameState.superModeTimer) {
                    clearTimeout(gameState.superModeTimer);
                }
                
                gameState.superModeTimer = setTimeout(() => {
                    toggleSuperMode(false);
                }, 60000); // 60ç§’åè‡ªåŠ¨å…³é—­
                
                // æ˜¾ç¤ºæç¤º
                showPopupMessage('è¶…çº§æ¨¡å¼å·²æ¿€æ´»ï¼é‡Šæ”¾å‹åŠ›æ•ˆæœå¢å¼ºï¼', 2000);
            } else {
                if (indicator) {
                    indicator.remove();
                }
                
                if (gameState.superModeTimer) {
                    clearTimeout(gameState.superModeTimer);
                    gameState.superModeTimer = null;
                }
            }
        }
        
        // UIæ›´æ–°åŠŸèƒ½
        function updatePressureDisplay() {
            // è®¡ç®—å‹åŠ›æ¡å®½åº¦ï¼Œæœ€å¤§100%
            const barWidth = Math.min(gameState.currentPressure, 100);
            pressureBar.style.width = barWidth + '%';
            
            // æ›´æ–°å‹åŠ›å€¼æ˜¾ç¤º
            pressureValue.textContent = Math.floor(gameState.currentPressure);
            
            // è°ƒæ•´å‹åŠ›æ¡çš„æ¸å˜ä½ç½®ï¼Œä»¥åœ¨é«˜å‹åŠ›ä¸‹æ˜¾ç¤ºçº¢è‰²åŒºåŸŸ
            if (gameState.currentPressure > 100) {
                const gradientPos = Math.min((gameState.currentPressure - 100) / 5, 100);
                pressureBar.style.backgroundPosition = `${gradientPos}% 0`;
            } else {
                pressureBar.style.backgroundPosition = '0% 0';
            }
            
            // æ ¹æ®å‹åŠ›æ›´æ–°æŒ‰é’®å¤–è§‚
            if (gameState.isPressed) {
                if (gameState.touchType !== 'rapid') {
                    if (gameState.currentPressure > 500) {
                        mouthButton.textContent = 'ğŸ¤¯';
                    } else if (gameState.currentPressure > 300) {
                        mouthButton.textContent = 'ğŸ˜µ';
                    } else if (gameState.currentPressure > 150) {
                        mouthButton.textContent = 'ğŸ˜±';
                    } else if (gameState.currentPressure > 80) {
                        mouthButton.textContent = 'ğŸ˜«';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = 'ğŸ˜²';
                    } else if (gameState.currentPressure > 20) {
                        mouthButton.textContent = 'ğŸ˜¯';
                    }
                }
                
                // éšå‹åŠ›ç¨å¾®ç¼©æ”¾æŒ‰é’®
                let scale = 1;
                
                if (gameState.currentPressure <= 100) {
                    scale = 1 + (gameState.currentPressure / 500);
                } else if (gameState.currentPressure <= 500) {
                    scale = 1.2 + ((gameState.currentPressure - 100) / 1000);
                } else {
                    scale = 1.6 + ((gameState.currentPressure - 500) / 5000);
                }
                
                mouthButton.style.transform = `scale(${scale})`;
                
                // è¶…é«˜å‹åŠ›æ—¶æ·»åŠ å‘å…‰æ•ˆæœ
                if (gameState.currentPressure > 300) {
                    const intensity = Math.min((gameState.currentPressure - 300) / 10, 30);
                    mouthButton.style.boxShadow = `0 8px 20px rgba(255, 107, 107, 0.4), 
                                                   0 2px 8px rgba(0, 0, 0, 0.2),
                                                   inset 0 -2px 5px rgba(0, 0, 0, 0.1),
                                                   inset 0 2px 5px rgba(255, 255, 255, 0.5),
                                                   0 0 ${intensity}px ${intensity/2}px rgba(255, 50, 50, 0.8)`;
                }
            } else {
                mouthButton.style.transform = 'scale(1)';
                mouthButton.style.boxShadow = `0 8px 20px rgba(255, 107, 107, 0.4), 
                                              0 2px 8px rgba(0, 0, 0, 0.2),
                                              inset 0 -2px 5px rgba(0, 0, 0, 0.1),
                                              inset 0 2px 5px rgba(255, 255, 255, 0.5)`;
            }
        }
        
        function showPopupMessage(message, duration) {
            popupMessage.textContent = message;
            popupMessage.style.display = 'block';
            
            setTimeout(() => {
                popupMessage.style.display = 'none';
            }, duration);
        }
        
        // ä¸»æ¸¸æˆå¾ªç¯
        function gameLoop() {
            const now = Date.now();
            const deltaTime = now - gameState.lastFrame;
            gameState.lastFrame = now;
            
            // å¦‚æœæŒ‰é’®è¢«æŒ‰ä¸‹ï¼Œåˆ™æ›´æ–°å‹åŠ›
            if (gameState.isPressed) {
                const elapsedSinceUpdate = now - gameState.lastPressureUpdate;
                
                if (elapsedSinceUpdate >= 100) { // æ¯100msæ›´æ–°ä¸€æ¬¡
                    // åŸºäºè§¦æ‘¸ç±»å‹çš„ä¸åŒå‹åŠ›å¢é•¿ç‡
                    let increaseAmount;
                    
                    if (gameState.touchType === 'rapid') {
                        increaseAmount = gameState.pressureIncreaseRate * 2.5;
                    } else {
                        increaseAmount = gameState.pressureIncreaseRate;
                    }
                    
                    // é•¿æŒ‰æ—¶é—´è¶Šé•¿ï¼Œå¢é•¿ç‡è¶Šå¤§
                    const pressTime = now - gameState.pressStartTime;
                    const timeBonus = (pressTime > 3000) ? (pressTime - 3000) / 10000 : 0;
                    increaseAmount += timeBonus;
                    
                    // è¶…çº§æ¨¡å¼å¢åŠ å¢é•¿ç‡
                    if (gameState.superModeActive) {
                        increaseAmount *= 1.5;
                    }
                    
                    // ä¸å†è®¾ç½®ä¸Šé™å€¼
                    gameState.currentPressure += increaseAmount;
                    gameState.lastPressureUpdate = now;
                    
                    // åŸºäºå‹åŠ›åˆ›å»ºè§†è§‰æ•ˆæœ
                    if (gameState.currentPressure > 20) {
                        createSoundWave(Math.min(gameState.currentPressure, 300)); // é™åˆ¶å£°æ³¢å¤§å°
                        
                        if (Math.random() < gameState.currentPressure / 500) {
                            createParticle(gameState.currentPressure);
                        }
                        
                        if (gameState.currentPressure > 40 && Math.random() < 0.3) {
                            applyScreenShake(Math.min(gameState.currentPressure, 200)); // é™åˆ¶æŠ–åŠ¨å¹…åº¦
                        }
                        
                        // é«˜å‹åŠ›ç‰¹æ®Šæ•ˆæœ
                        if (gameState.currentPressure > 300 && gameState.customEffectsUnlocked.includes('neon-explosion') && Math.random() < 0.05) {
                            createNeonParticle(gameState.currentPressure);
                        }
                        
                        if (gameState.currentPressure > 400 && gameState.customEffectsUnlocked.includes('text-shower') && Math.random() < 0.02) {
                            createTextEffect(gameState.currentPressure);
                        }
                    }
                }
                
                updatePressureDisplay();
            }
            
            // æ›´æ–°æ‰€æœ‰è§†è§‰æ•ˆæœ
            updateVisualEffects(deltaTime);
            
            // ç»§ç»­å¾ªç¯
            gameState.animationFrameId = requestAnimationFrame(gameLoop);
            
            // å¦‚æœæ²¡æœ‰æ´»åŠ¨ï¼Œåœæ­¢å¾ªç¯
            if (!gameState.isPressed && gameState.particles.length === 0 && gameState.soundWaves.length === 0 && gameState.neonParticles.length === 0) {
                cancelAnimationFrame(gameState.animationFrameId);
                gameState.animationFrameId = null;
            }
        }
        
        // æ§åˆ¶åŠŸèƒ½
        function toggleCheckinPanel() {
            gameState.checkinVisible = !gameState.checkinVisible;
            checkinPanel.style.display = gameState.checkinVisible ? 'block' : 'none';
            
            if (gameState.checkinVisible) {
                updateCheckinDisplay();
            }
        }
        
        function toggleEffectsEnabled() {
            gameState.effectsEnabled = !gameState.effectsEnabled;
            toggleEffects.textContent = gameState.effectsEnabled ? 'âœ¨' : 'ğŸš«';
            
            if (!gameState.effectsEnabled) {
                // æ¸…é™¤æ‰€æœ‰ç°æœ‰æ•ˆæœ
                effectsContainer.innerHTML = '';
                gameState.particles = [];
                gameState.soundWaves = [];
                gameState.neonParticles = [];
                gameState.textEffects = [];
                gameState.shockwaves = [];
                
                // å…³é—­èƒŒæ™¯åŠ¨ç”»
                if (gameState.backgroundAnimationActive) {
                    document.body.style.animation = 'none';
                    gameState.backgroundAnimationActive = false;
                }
            }
        }
        
        function toggleSoundEnabled() {
            gameState.soundEnabled = !gameState.soundEnabled;
            toggleSound.textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        // åˆå§‹åŒ–åŠŸèƒ½
        function init() {
            // åŠ è½½æˆå°±å’Œè‡ªå®šä¹‰æ•ˆæœ
            loadAchievements();
            loadCustomEffects();
            
            // åŠ è½½ç´¯è®¡é‡Šæ”¾å€¼
            const statsData = loadStatsData();
            gameState.totalPressureReleased = statsData.totalReleased || 0;
            
            // æ›´æ–°è¶…çº§æ¨¡å¼æŒ‰é’®
            const superModeAchievement = achievements.find(a => a.id === 'super-mode');
            if (superModeAchievement && superModeAchievement.unlocked) {
                toggleSuper.textContent = 'ğŸ’¤'; // è§£é”ä½†æœªæ¿€æ´»
            } else {
                toggleSuper.textContent = 'ğŸ”’'; // æœªè§£é”
            }
            
            // åˆå§‹åŒ–æ‰“å¡é¢æ¿
            updateCheckinDisplay();
            
            // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
            setTimeout(() => {
                showPopupMessage('æ¬¢è¿ä½¿ç”¨å°–å«çˆ†å‘å™¨Plusç‰ˆï¼', 2000);
            }, 500);
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        mouthButton.addEventListener('touchstart', handleTouchStart);
        mouthButton.addEventListener('touchmove', handleTouchMove);
        mouthButton.addEventListener('touchend', handleTouchEnd);
        
        // é¼ æ ‡å›é€€ï¼Œç”¨äºåœ¨æ¡Œé¢ä¸Šæµ‹è¯•
        mouthButton.addEventListener('mousedown', handleTouchStart);
        mouthButton.addEventListener('mousemove', handleTouchMove);
        mouthButton.addEventListener('mouseup', handleTouchEnd);
        
        // æ§åˆ¶æŒ‰é’®
        toggleCheckin.addEventListener('click', toggleCheckinPanel);
        toggleEffects.addEventListener('click', toggleEffectsEnabled);
        toggleSuper.addEventListener('click', () => toggleSuperMode());
        toggleSound.addEventListener('click', toggleSoundEnabled);
        
        // é˜²æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸ºä»¥é¿å…æ»šåŠ¨
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
        
        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
