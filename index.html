<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>尖叫爆发器Plus版</title>
    <style>
        /* 基础样式重置和全页面设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            touch-action: none; /* 防止浏览器处理触摸事件 */
        }
        
        /* 游戏容器 */
        #gameContainer {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        
        /* 头部 */
        #gameHeader {
            width: 100%;
            text-align: center;
            padding: 10px;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
        }
        
        /* 主游戏区域 */
        #gameplayArea {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* 嘴巴按钮 */
        #mouthButton {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ff6b6b;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            z-index: 20;
        }
        
        #mouthButton:active {
            transform: scale(0.95);
        }
        
        /* 特效容器 */
        #effectsContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 5;
        }
        
        /* 压力计 */
        #pressureMeter {
            width: 80%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            position: relative;
        }
        
        #pressureBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            transition: width 0.1s;
        }
        
        #pressureValue {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            color: #333;
        }
        
        /* 打卡面板 */
        #checkinPanel {
            width: 90%;
            max-height: 40%;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 30;
        }
        
        .checkinHeader {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .checkinGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .checkinDay {
            padding: 5px;
            text-align: center;
            border-radius: 5px;
            background-color: #f0f0f0;
            font-size: 14px;
            position: relative;
        }
        
        .checkinDay.active {
            background-color: #4facfe;
            color: white;
        }
        
        .checkinValue {
            font-size: 10px;
            position: absolute;
            bottom: 2px;
            right: 2px;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        /* 控制按钮 */
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 40;
        }
        
        .controlButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 20px;
        }
        
        /* 声波动画 */
        @keyframes soundWave {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        .soundWave {
            position: absolute;
            border-radius: 50%;
            border: 2px solid #ff6b6b;
            animation: soundWave 1s infinite;
            pointer-events: none;
        }
        
        /* 弹出消息 */
        #popupMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 18px;
            z-index: 50;
            display: none;
        }
        
        /* 响应式适配不同设备尺寸 */
        @media (max-height: 600px) {
            #mouthButton {
                width: 100px;
                height: 100px;
                font-size: 50px;
            }
            
            #checkinPanel {
                max-height: 30%;
            }
        }
        
        @media (max-width: 360px) {
            #mouthButton {
                width: 90px;
                height: 90px;
                font-size: 45px;
            }
            
            .checkinGrid {
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
            }
            
            .checkinDay {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameHeader">尖叫爆发器Plus版</div>
        
        <div id="gameplayArea">
            <div id="mouthButton">😮</div>
            <div id="effectsContainer"></div>
        </div>
        
        <div id="pressureMeter">
            <div id="pressureBar"></div>
            <div id="pressureValue">0%</div>
        </div>
        
        <div id="checkinPanel">
            <div class="checkinHeader">
                本月最高释放值: <span id="monthMax">0</span>
            </div>
            <div class="checkinGrid" id="checkinGrid"></div>
        </div>
        
        <div id="controls">
            <div class="controlButton" id="toggleCheckin">📅</div>
            <div class="controlButton" id="toggleEffects">✨</div>
            <div class="controlButton" id="toggleSound">🔊</div>
        </div>
    </div>
    
    <div id="popupMessage"></div>
    
    <script>
        // 游戏状态
        const gameState = {
            isPressed: false,
            pressStartTime: 0,
            currentPressure: 0,
            maxPressure: 0,
            lastPressureUpdate: 0,
            pressureIncreaseRate: 2, // 每100ms增加的百分比
            effectsEnabled: true,
            soundEnabled: true,
            checkinVisible: false,
            particles: [],
            soundWaves: [],
            maxParticles: 150, // 性能限制
            touchType: '', // 'short', 'long', 或 'rapid'
            rapidPressCount: 0,
            rapidPressTimeout: null,
            animationFrameId: null,
            lastFrame: 0
        };
        
        // DOM元素
        const mouthButton = document.getElementById('mouthButton');
        const effectsContainer = document.getElementById('effectsContainer');
        const pressureBar = document.getElementById('pressureBar');
        const pressureValue = document.getElementById('pressureValue');
        const checkinPanel = document.getElementById('checkinPanel');
        const checkinGrid = document.getElementById('checkinGrid');
        const monthMax = document.getElementById('monthMax');
        const popupMessage = document.getElementById('popupMessage');
        const toggleCheckin = document.getElementById('toggleCheckin');
        const toggleEffects = document.getElementById('toggleEffects');
        const toggleSound = document.getElementById('toggleSound');
        
        // 检查存储是否可用
        function storageAvailable(type) {
            try {
                const storage = window[type];
                const x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return true;
            } catch (e) {
                return false;
            }
        }
        
        // 本地存储功能
        function saveCheckin(pressure) {
            if (!storageAvailable('localStorage')) return;
            
            const today = new Date();
            const dateKey = today.toISOString().split('T')[0]; // YYYY-MM-DD
            const monthKey = dateKey.substring(0, 7); // YYYY-MM
            
            // 获取现有数据
            let checkinData = JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
            
            // 更新今天的数据
            if (!checkinData[dateKey] || pressure > checkinData[dateKey]) {
                checkinData[dateKey] = pressure;
            }
            
            // 更新月最大值
            let monthMaxValue = 0;
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // 保存数据
            localStorage.setItem('screamCheckinData', JSON.stringify(checkinData));
            
            // 更新UI
            updateCheckinDisplay();
        }
        
        function loadCheckinData() {
            if (!storageAvailable('localStorage')) return {};
            
            return JSON.parse(localStorage.getItem('screamCheckinData') || '{}');
        }
        
        function updateCheckinDisplay() {
            // 清除现有网格
            checkinGrid.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // 月份第一天
            const firstDay = new Date(currentYear, currentMonth, 1);
            // 月份最后一天
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            
            // 第一天的星期（0=周日，6=周六）
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // 创建星期标题（周日-周六）
            const weekDays = ['日', '一', '二', '三', '四', '五', '六'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'checkinDay';
                dayHeader.style.backgroundColor = '#ddd';
                dayHeader.textContent = day;
                checkinGrid.appendChild(dayHeader);
            });
            
            // 为月份第一天之前添加空单元格
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'checkinDay';
                emptyDay.style.visibility = 'hidden';
                checkinGrid.appendChild(emptyDay);
            }
            
            // 获取打卡数据
            const checkinData = loadCheckinData();
            
            // 计算月最大值
            let monthMaxValue = 0;
            const monthKey = today.toISOString().substring(0, 7); // YYYY-MM
            
            for (const date in checkinData) {
                if (date.startsWith(monthKey) && checkinData[date] > monthMaxValue) {
                    monthMaxValue = checkinData[date];
                }
            }
            
            // 更新月最大值显示
            monthMax.textContent = monthMaxValue.toFixed(0);
            
            // 添加月份的天数
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'checkinDay';
                dayCell.textContent = i;
                
                // 检查这一天是否有打卡
                const dateString = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                
                if (checkinData[dateString]) {
                    dayCell.classList.add('active');
                    
                    // 添加压力值
                    const valueSpan = document.createElement('div');
                    valueSpan.className = 'checkinValue';
                    valueSpan.textContent = checkinData[dateString].toFixed(0);
                    dayCell.appendChild(valueSpan);
                }
                
                checkinGrid.appendChild(dayCell);
            }
        }
        
        // 特效生成功能
        function createParticle(pressure) {
            if (!gameState.effectsEnabled || gameState.particles.length >= gameState.maxParticles) return;
            
            // 创建粒子元素
            const particle = document.createElement('div');
            particle.style.position = 'absolute';
            particle.style.pointerEvents = 'none';
            
            // 在按钮周围随机定位
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            const distance = 50 + (Math.random() * pressure * 1.5); // 压力越高，距离越远
            
            const posX = centerX + Math.cos(angle) * distance;
            const posY = centerY + Math.sin(angle) * distance;
            
            particle.style.left = posX + 'px';
            particle.style.top = posY + 'px';
            
            // 根据压力确定内容
            let content;
            let fontSize;
            
            if (pressure < 30) {
                // 低压力：简单文本
                const options = ['a', 'あ', '啊', '아', '!', '?', '😮', '😯', '😲'];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 12 + Math.random() * 8;
            } else if (pressure < 70) {
                // 中等压力：更具表现力
                const options = ['aa', 'ああ', '啊啊', '아아', '!!', '?!', '😮', '😲', '😱', '😫'];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 16 + Math.random() * 12;
            } else {
                // 高压力：强烈表达
                const options = [
                    'AAA', 'あああ', '啊啊啊', '아아아', '!!!', '?!!', 
                    '😱', '😫', '😖', '😵', '😨', '💥', '💫', '💢', '⚡'
                ];
                content = options[Math.floor(Math.random() * options.length)];
                fontSize = 20 + Math.random() * 16;
            }
            
            // 应用样式
            particle.textContent = content;
            particle.style.fontSize = fontSize + 'px';
            particle.style.opacity = '0.9';
            particle.style.transform = 'rotate(' + (Math.random() * 40 - 20) + 'deg)';
            
            // 动画设置
            const duration = 1000 + Math.random() * 1000; // 1-2秒
            const directionX = (Math.random() - 0.5) * (pressure / 20); // 压力越高，扩散越大
            const directionY = (Math.random() - 0.5 - 0.2) * (pressure / 15); // 轻微向上偏移
            
            // 添加到DOM
            effectsContainer.appendChild(particle);
            
            // 添加到粒子数组
            gameState.particles.push({
                element: particle,
                posX,
                posY,
                directionX,
                directionY,
                rotation: (Math.random() - 0.5) * 10,
                opacity: 0.9,
                duration,
                elapsed: 0
            });
        }
        
        function createSoundWave(pressure) {
            if (!gameState.effectsEnabled) return;
            
            const wave = document.createElement('div');
            wave.className = 'soundWave';
            
            const size = 80 + pressure * 1.5;
            wave.style.width = size + 'px';
            wave.style.height = size + 'px';
            
            // 居中定位
            wave.style.left = 'calc(50% - ' + (size / 2) + 'px)';
            wave.style.top = 'calc(50% - ' + (size / 2) + 'px)';
            
            // 基于压力的动画持续时间
            const duration = 1000 - (pressure * 5); // 压力越高越快
            wave.style.animationDuration = Math.max(duration, 300) + 'ms';
            
            // 添加到DOM
            effectsContainer.appendChild(wave);
            
            // 添加到波数组
            gameState.soundWaves.push({
                element: wave,
                duration: Math.max(duration, 300),
                elapsed: 0
            });
        }
        
        function applyScreenShake(pressure) {
            if (!gameState.effectsEnabled || pressure < 40) return;
            
            const intensity = pressure / 10;
            const gameContainer = document.getElementById('gameContainer');
            
            // 清除现有的抖动
            gameContainer.style.transform = 'none';
            
            // 抖动效果的随机位置
            const shakeX = (Math.random() - 0.5) * intensity;
            const shakeY = (Math.random() - 0.5) * intensity;
            
            gameContainer.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
            
            // 短暂延迟后重置
            setTimeout(() => {
                gameContainer.style.transform = 'none';
            }, 50);
        }
        
        function updateVisualEffects(deltaTime) {
            // 更新粒子
            for (let i = gameState.particles.length - 1; i >= 0; i--) {
                const particle = gameState.particles[i];
                particle.elapsed += deltaTime;
                
                if (particle.elapsed >= particle.duration) {
                    // 移除过期粒子
                    particle.element.remove();
                    gameState.particles.splice(i, 1);
                } else {
                    // 更新位置
                    particle.posX += particle.directionX * deltaTime * 0.1;
                    particle.posY += particle.directionY * deltaTime * 0.1;
                    
                    // 更新不透明度
                    const progress = particle.elapsed / particle.duration;
                    particle.opacity = 0.9 * (1 - progress);
                    
                    // 应用更新
                    particle.element.style.left = particle.posX + 'px';
                    particle.element.style.top = particle.posY + 'px';
                    particle.element.style.opacity = particle.opacity;
                    particle.element.style.transform = `rotate(${particle.rotation * progress * 10}deg)`;
                }
            }
            
            // 更新声波
            for (let i = gameState.soundWaves.length - 1; i >= 0; i--) {
                const wave = gameState.soundWaves[i];
                wave.elapsed += deltaTime;
                
                if (wave.elapsed >= wave.duration) {
                    // 移除过期波
                    wave.element.remove();
                    gameState.soundWaves.splice(i, 1);
                }
            }
        }
        
        // 触摸事件处理程序
        function handleTouchStart(e) {
            e.preventDefault();
            if (gameState.isPressed) return;
            
            gameState.isPressed = true;
            gameState.pressStartTime = Date.now();
            gameState.currentPressure = 0;
            gameState.lastPressureUpdate = Date.now();
            
            // 处理快速按压检测
            if (gameState.rapidPressTimeout) {
                clearTimeout(gameState.rapidPressTimeout);
                gameState.rapidPressCount++;
                
                if (gameState.rapidPressCount >= 3) {
                    gameState.touchType = 'rapid';
                    // 改变嘴巴到快速模式
                    mouthButton.textContent = '😬';
                }
            } else {
                gameState.rapidPressCount = 1;
            }
            
            gameState.rapidPressTimeout = setTimeout(() => {
                gameState.rapidPressCount = 0;
                gameState.rapidPressTimeout = null;
            }, 500);
            
            // 以正常表情开始
            if (gameState.touchType !== 'rapid') {
                mouthButton.textContent = '😮';
            }
            
            // 如果尚未运行，则启动动画循环
            if (!gameState.animationFrameId) {
                gameState.lastFrame = Date.now();
                gameState.animationFrameId = requestAnimationFrame(gameLoop);
            }
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            if (!gameState.isPressed) return;
            
            gameState.isPressed = false;
            const pressDuration = Date.now() - gameState.pressStartTime;
            
            // 如果尚未确定为快速按压，则确定按压类型
            if (gameState.touchType !== 'rapid') {
                if (pressDuration < 300) {
                    gameState.touchType = 'short';
                    mouthButton.textContent = '😯';
                } else {
                    gameState.touchType = 'long';
                    
                    // 根据最终压力重置嘴巴
                    if (gameState.currentPressure > 80) {
                        mouthButton.textContent = '😱';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = '😲';
                    } else {
                        mouthButton.textContent = '😮';
                    }
                }
            }
            
            // 处理释放效果
            handlePressureRelease();
            
            // 延迟后重置
            setTimeout(() => {
                mouthButton.textContent = '😮';
                gameState.touchType = '';
                gameState.currentPressure = 0;
                updatePressureDisplay();
            }, 1000);
        }
        
        function handlePressureRelease() {
            // 保存达到的最大压力
            const finalPressure = gameState.currentPressure;
            gameState.maxPressure = Math.max(gameState.maxPressure, finalPressure);
            
            // 保存打卡
            saveCheckin(finalPressure);
            
            // 显示完成消息
            showPopupMessage('今日打卡完成！', 2000);
            
            // 根据压力和触摸类型创建爆发效果
            if (gameState.effectsEnabled) {
                if (gameState.touchType === 'rapid') {
                    // 快速按压效果：大量小粒子
                    for (let i = 0; i < 30; i++) {
                        createParticle(Math.min(finalPressure + 30, 100));
                    }
                } else if (gameState.touchType === 'short') {
                    // 短按效果：少量中等粒子
                    for (let i = 0; i < 10; i++) {
                        createParticle(Math.min(finalPressure + 20, 100));
                    }
                } else {
                    // 长按效果：基于压力
                    const particleCount = Math.floor(finalPressure / 5) + 5;
                    for (let i = 0; i < particleCount; i++) {
                        createParticle(finalPressure);
                    }
                    
                    // 高压力的额外效果
                    if (finalPressure > 70) {
                        for (let i = 0; i < 20; i++) {
                            setTimeout(() => {
                                createParticle(finalPressure);
                                applyScreenShake(finalPressure);
                            }, i * 50);
                        }
                    }
                }
            }
        }
        
        // UI更新功能
        function updatePressureDisplay() {
            pressureBar.style.width = gameState.currentPressure + '%';
            pressureValue.textContent = Math.floor(gameState.currentPressure) + '%';
            
            // 根据压力更新按钮外观
            if (gameState.isPressed) {
                if (gameState.touchType !== 'rapid') {
                    if (gameState.currentPressure > 80) {
                        mouthButton.textContent = '😱';
                    } else if (gameState.currentPressure > 60) {
                        mouthButton.textContent = '😫';
                    } else if (gameState.currentPressure > 40) {
                        mouthButton.textContent = '😲';
                    } else if (gameState.currentPressure > 20) {
                        mouthButton.textContent = '😯';
                    }
                }
                
                // 随压力稍微缩放按钮
                const scale = 1 + (gameState.currentPressure / 500);
                mouthButton.style.transform = `scale(${scale})`;
            } else {
                mouthButton.style.transform = 'scale(1)';
            }
        }
        
        function showPopupMessage(message, duration) {
            popupMessage.textContent = message;
            popupMessage.style.display = 'block';
            
            setTimeout(() => {
                popupMessage.style.display = 'none';
            }, duration);
        }
        
        // 主游戏循环
        function gameLoop() {
            const now = Date.now();
            const deltaTime = now - gameState.lastFrame;
            gameState.lastFrame = now;
            
            // 如果按钮被按下，则更新压力
            if (gameState.isPressed) {
                const elapsedSinceUpdate = now - gameState.lastPressureUpdate;
                
                if (elapsedSinceUpdate >= 100) { // 每100ms更新一次
                    // 基于触摸类型的不同压力增长率
                    let increaseAmount;
                    
                    if (gameState.touchType === 'rapid') {
                        increaseAmount = gameState.pressureIncreaseRate * 2.5;
                    } else {
                        increaseAmount = gameState.pressureIncreaseRate;
                    }
                    
                    gameState.currentPressure = Math.min(100, gameState.currentPressure + increaseAmount);
                    gameState.lastPressureUpdate = now;
                    
                    // 基于压力创建视觉效果
                    if (gameState.currentPressure > 20) {
                        createSoundWave(gameState.currentPressure);
                        
                        if (Math.random() < gameState.currentPressure / 100) {
                            createParticle(gameState.currentPressure);
                        }
                        
                        if (gameState.currentPressure > 40 && Math.random() < 0.3) {
                            applyScreenShake(gameState.currentPressure);
                        }
                    }
                }
                
                updatePressureDisplay();
            }
            
            // 更新所有视觉效果
            updateVisualEffects(deltaTime);
            
            // 继续循环
            gameState.animationFrameId = requestAnimationFrame(gameLoop);
            
            // 如果没有活动，停止循环
            if (!gameState.isPressed && gameState.particles.length === 0 && gameState.soundWaves.length === 0) {
                cancelAnimationFrame(gameState.animationFrameId);
                gameState.animationFrameId = null;
            }
        }
        
        // 控制功能
        function toggleCheckinPanel() {
            gameState.checkinVisible = !gameState.checkinVisible;
            checkinPanel.style.display = gameState.checkinVisible ? 'block' : 'none';
            
            if (gameState.checkinVisible) {
                updateCheckinDisplay();
            }
        }
        
        function toggleEffectsEnabled() {
            gameState.effectsEnabled = !gameState.effectsEnabled;
            toggleEffects.textContent = gameState.effectsEnabled ? '✨' : '🚫';
            
            if (!gameState.effectsEnabled) {
                // 清除所有现有效果
                effectsContainer.innerHTML = '';
                gameState.particles = [];
                gameState.soundWaves = [];
            }
        }
        
        function toggleSoundEnabled() {
            gameState.soundEnabled = !gameState.soundEnabled;
            toggleSound.textContent = gameState.soundEnabled ? '🔊' : '🔇';
        }
        
        // 事件监听器
        mouthButton.addEventListener('touchstart', handleTouchStart);
        mouthButton.addEventListener('touchmove', handleTouchMove);
        mouthButton.addEventListener('touchend', handleTouchEnd);
        
        // 鼠标回退，用于在桌面上测试
        mouthButton.addEventListener('mousedown', handleTouchStart);
        mouthButton.addEventListener('mousemove', handleTouchMove);
        mouthButton.addEventListener('mouseup', handleTouchEnd);
        
        // 控制按钮
        toggleCheckin.addEventListener('click', toggleCheckinPanel);
        toggleEffects.addEventListener('click', toggleEffectsEnabled);
        toggleSound.addEventListener('click', toggleSoundEnabled);
        
        // 防止默认触摸行为以避免滚动
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
        
        // 初始设置
        updateCheckinDisplay();
        
        // 欢迎消息
        showPopupMessage('欢迎使用尖叫爆发器Plus版！', 2000);
    </script>
</body>
</html>
